import{c as a,d as l,F as g,a as t,r as h,w as f,j as A,G as I,o as r,h as y,n as R,i as k,b as u,t as m}from"./app-DB903dGk.js";import{T as L,M as N,P as F,i as b,a as M}from"./Table-C_6oH8I7.js";import{P as V,I as j}from"./Input-BL7OSBt_.js";import{B}from"./Button-MYDuztI5.js";import{f as q,a as O,D as G}from"./dateUtils-CA0ranRn.js";import{D as W,a as Y,U as H,A as J}from"./DeleteRolesModal-Clgn9xTz.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{L as D}from"./mail-BQRDUCKB.js";import{P as Q}from"./pencil-DOMdoccY.js";import{P as X}from"./plus-xzKPLU_4.js";import"./createLucideIcon-DIXLg_3g.js";import"./Tooltip-CiqB0ikv.js";import"./Drawer-CZjGLGn_.js";import"./arrow-up-B1IjiNg6.js";import"./Switch-C8ssyrhM.js";import"./vue-draggable-next.esm-bundler-C4jc-Uhl.js";import"./circle-alert-CEfAiM3V.js";const Z={inject:["formState","notificationState"],components:{Pill:F,Modal:N,Input:j,Button:B,Popover:V,Dropdown:G,Table:L,AddRoleModal:J,UpdateRoleModal:H,DeleteRoleModal:Y,DeleteRolesModal:W,Lock:D},data(){return{Plus:X,Pencil:Q,Trash2:M,Lock:D,roles:[],perPage:"15",getCountryName:I,checkedRows:[],pagination:null,searchTerm:null,selectAll:!1,filterExpressions:[],sortingExpressions:[],isLoadingRoles:!1,columns:this.prepareColumns(),dropdownOptions:[{icon:M,label:"Delete",action:this.showDeleteRolesModal}]}},watch:{selectAll(s){this.checkedRows=this.roles.reduce((e,d)=>(e[d.id]=s,e),{})}},computed:{hasSearchTerm(){return this.searchTerm!=null&&this.searchTerm.trim()!==""},totalCheckedRows(){return Object.values(this.checkedRows).filter(Boolean).length},hasFilterExpressions(){return this.filterExpressions.length>0},hasSortingExpressions(){return this.sortingExpressions.length>0},showTable(){var s;return this.isLoadingRoles||((s=(this.pagination??{}).meta)==null?void 0:s.total)>0||this.hasSearchTerm||this.hasFilterExpressions||this.hasSortingExpressions}},methods:{formattedDatetime:O,formattedRelativeDate:q,prepareColumns(){const s=["Name","Oraganization","Country","Guard","Users","Created Date"],e=["Name","Oraganization","Country","Guard","Users","Created Date"];return s.map(d=>({name:d,active:e.includes(d),priority:e.includes(d)}))},showAddRoleModal(){this.$refs.addRoleModal.showModal()},showUpdateRoleModal(s){this.$refs.updateRoleModal.showModal(s)},showDeleteRoleModal(s){this.$refs.deleteRoleModal.showModal(s)},showDeleteRolesModal(){const s=this.roles.filter(e=>this.checkedRows[e.id]).map(e=>e.id);this.$refs.deleteRolesModal.showModal(s)},onRoleDeleted(s){this.roles=this.roles.filter(e=>e.id!==s),this.roles.length===0&&this.fetchRoles()},onRolesDeleted(s=[]){s.forEach(e=>{this.checkedRows[e]!==void 0&&(this.checkedRows[e]=!1)}),this.selectAll=!1,this.roles=this.roles.filter(e=>!s.includes(e.id)),this.roles.length===0&&this.fetchRoles()},paginate(s){this.fetchRoles(s)},search(s){this.searchTerm=s,this.fetchRoles()},updatedColumns(s){this.columns=s},updatedFilters(s){const e=s.map(d=>d.expression);b(this.filterExpressions,e)||(this.filterExpressions=e,this.fetchRoles())},updatedSorting(s){const e=s.map(d=>d.expression);b(this.sortingExpressions,e)||(this.sortingExpressions=e,this.fetchRoles())},updatedPerPage(s){this.perPage=s,this.fetchRoles()},async fetchRoles(s=null){var e,d;try{this.isLoadingRoles=!0,s=s??"/api/roles";let c={params:{per_page:this.perPage,_relationships:"organization",_countable_relationships:"users"}};this.hasSearchTerm&&(c.params.search=this.searchTerm),this.hasFilterExpressions&&(c.params._filters=this.filterExpressions.join("|")),this.hasSortingExpressions&&(c.params._sort=this.sortingExpressions.join("|"));const o=await A.get(s,c);this.pagination=o.data,this.roles=this.pagination.data,this.checkedRows=this.roles.reduce((i,x)=>(i[x.id]=!1,i),{})}catch(c){const o=((d=(e=c==null?void 0:c.response)==null?void 0:e.data)==null?void 0:d.message)||(c==null?void 0:c.message)||"Something went wrong while fetching roles";this.notificationState.showWarningNotification(o),console.error("Failed to fetch roles:",c)}finally{this.isLoadingRoles=!1}}},created(){this.isLoadingRoles=!0,this.searchTerm=this.$route.query.searchTerm,this.$route.query.filterExpressions&&(this.filterExpressions=this.$route.query.filterExpressions.split("|")),this.$route.query.sortingExpressions&&(this.sortingExpressions=this.$route.query.sortingExpressions.split("|")),this.fetchRoles()}},$={class:"select-none min-h-screen bg-gray-50 pt-8 p-4 sm:p-8 space-y-4 sm:space-y-6"},ee={class:"flex justify-between"},se={class:"flex items-end space-x-2"},te={class:"flex justify-end"},oe={class:"border-b border-indigo-200"},ne={scope:"col",class:"whitespace-nowrap align-top font-semibold px-4 py-2.5"},ie=["onClick"],ae={key:0,class:"whitespace-nowrap align-center pr-4 py-4"},re={key:1,class:"whitespace-nowrap align-center pr-4 py-4"},le={key:0,class:"flex items-center space-x-2"},de={class:"whitespace-nowrap"},ce={key:2,class:"whitespace-nowrap align-center pr-4 py-4"},pe={key:0,class:"flex items-center space-x-2"},he={class:"flex items-center space-x-2"},ue=["alt","src"],me={key:3,class:"whitespace-nowrap align-center pr-4 py-4"},ge={key:4,class:"whitespace-nowrap align-center text-center pr-4 py-4"},fe={key:5,class:"whitespace-nowrap align-center pr-4 py-4"},xe={class:"flex space-x-1 items-center"},we={class:"h-16 pr-4 py-4 flex align-middle items-center space-x-2"},ye={key:1,class:"select-none w-full flex justify-center py-16"},Re={class:"max-w-sm w-full bg-white shadow-sm rounded-xl p-6 flex flex-col items-center text-center space-y-4 border border-dashed border-gray-200"};function _e(s,e,d,c,o,i){const x=h("Lock"),w=h("Button"),E=h("Dropdown"),_=h("Input"),v=h("Popover"),P=h("Table"),C=h("AddRoleModal"),z=h("UpdateRoleModal"),S=h("DeleteRoleModal"),T=h("DeleteRolesModal");return r(),a("div",$,[i.showTable?(r(),a(g,{key:0},[t("div",ee,[t("div",se,[l(x,{size:"48","stroke-width":"1",class:"text-gray-400"}),e[2]||(e[2]=t("div",null,[t("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white"},"Roles"),t("p",{class:"text-sm text-gray-600 dark:text-neutral-400"}," Manage roles for your organization ")],-1))]),t("div",te,[l(w,{type:"primary",size:"md",leftIcon:o.Plus,leftIconSize:"20",action:i.showAddRoleModal},{default:f(()=>e[3]||(e[3]=[t("span",null,"Add Role",-1)])),_:1},8,["leftIcon","action"])])]),l(P,{resource:"roles",onSearch:i.search,columns:o.columns,perPage:o.perPage,onPaginate:i.paginate,onRefresh:i.fetchRoles,searchTerm:o.searchTerm,pagination:o.pagination,isLoading:o.isLoadingRoles,onUpdatedColumns:i.updatedColumns,onUpdatedFilters:i.updatedFilters,onUpdatedSorting:i.updatedSorting,onUpdatedPerPage:i.updatedPerPage,filterExpressions:o.filterExpressions,sortingExpressions:o.sortingExpressions},{belowToolbar:f(()=>[t("div",{class:R([{hidden:i.totalCheckedRows===0},"bg-gray-50 border flex items-center mb-2 p-4 rounded-lg shadow space-x-2"])},[e[4]||(e[4]=t("span",{class:"text-sm"},"Actions: ",-1)),l(E,{triggerSize:"sm",options:o.dropdownOptions,triggerText:`Select Action (${i.totalCheckedRows} selected)`},null,8,["options","triggerText"])],2)]),head:f(()=>[t("tr",oe,[t("th",ne,[l(_,{type:"checkbox",modelValue:o.selectAll,"onUpdate:modelValue":e[0]||(e[0]=n=>o.selectAll=n)},null,8,["modelValue"])]),(r(!0),a(g,null,y(o.columns,(n,p)=>(r(),a(g,{key:p},[n.active?(r(),a("th",{key:0,scope:"col",class:R(["whitespace-nowrap align-top font-semibold pr-4 py-2.5",{"text-center":["Users"].includes(n.name)}])},m(n.name),3)):u("",!0)],64))),128)),e[5]||(e[5]=t("th",{scope:"col",class:"whitespace-nowrap align-top font-semibold pr-4 py-2.5"},"Actions",-1))])]),body:f(()=>[(r(!0),a(g,null,y(o.roles,n=>(r(),a("tr",{onClick:k(p=>s.onView(n),["stop"]),key:n.id,class:R([o.checkedRows[n.id]?"bg-blue-50":"bg-white hover:bg-gray-50","group cursor-pointer text-sm border-b border-gray-200"])},[t("td",{onClick:e[1]||(e[1]=k(()=>{},["stop"])),class:"whitespace-nowrap align-top px-4 py-4"},[l(_,{type:"checkbox",modelValue:o.checkedRows[n.id],"onUpdate:modelValue":p=>o.checkedRows[n.id]=p},null,8,["modelValue","onUpdate:modelValue"])]),(r(!0),a(g,null,y(o.columns,(p,U)=>(r(),a(g,{key:U},[p.name=="Name"?(r(),a("td",ae,[t("div",null,m(n.name),1)])):u("",!0),p.name=="Oraganization"?(r(),a("td",re,[n.organization?(r(),a("div",le,[e[6]||(e[6]=t("img",{src:"https://placehold.co/21x24",class:"size-8 rounded-lg shrink-0",alt:"Logo"},null,-1)),t("div",de,m(n.organization.name),1)])):u("",!0)])):u("",!0),p.name=="Country"?(r(),a("td",ce,[n.organization?(r(),a("div",pe,[t("div",he,[n.organization.country?(r(),a("img",{key:0,alt:n.organization.country,class:"w-5 h-4 rounded-sm object-cover",src:`/svgs/country-flags/${n.organization.country.toLowerCase()}.svg`},null,8,ue)):u("",!0),t("span",null,m(o.getCountryName(n.organization.country)),1)])])):u("",!0)])):u("",!0),p.name=="Guard"?(r(),a("td",me,[t("span",null,m(n.guard_name),1)])):u("",!0),p.name=="Users"?(r(),a("td",ge,[t("span",null,m(n.users_count),1)])):u("",!0),p.name=="Created Date"?(r(),a("td",fe,[t("div",xe,[t("span",null,m(i.formattedDatetime(n.createdAt)),1),l(v,{placement:"top",class:"opacity-0 group-hover:opacity-100",content:i.formattedRelativeDate(n.createdAt)},null,8,["content"])])])):u("",!0)],64))),128)),t("td",we,[l(w,{type:"bare",size:"xs",leftIcon:o.Pencil,leftIconSize:"16",action:()=>i.showUpdateRoleModal(n)},null,8,["leftIcon","action"]),l(w,{type:"bareDanger",size:"xs",leftIcon:o.Trash2,leftIconSize:"16",action:()=>i.showDeleteRoleModal(n)},null,8,["leftIcon","action"])])],10,ie))),128))]),_:1},8,["onSearch","columns","perPage","onPaginate","onRefresh","searchTerm","pagination","isLoading","onUpdatedColumns","onUpdatedFilters","onUpdatedSorting","onUpdatedPerPage","filterExpressions","sortingExpressions"])],64)):(r(),a("div",ye,[t("div",Re,[l(x,{size:"48",class:"text-gray-400"}),e[8]||(e[8]=t("h2",{class:"text-2xl font-bold text-gray-800"},"No Roles Yet",-1)),e[9]||(e[9]=t("p",{class:"text-sm text-gray-500"},"Add a role to manage access control.",-1)),l(w,{type:"primary",size:"md",leftIcon:o.Plus,leftIconSize:"20",action:i.showAddRoleModal},{default:f(()=>e[7]||(e[7]=[t("span",null,"Add Role",-1)])),_:1},8,["leftIcon","action"])])])),l(C,{ref:"addRoleModal",onCreated:i.fetchRoles},null,8,["onCreated"]),l(z,{ref:"updateRoleModal",onUpdated:i.fetchRoles},null,8,["onUpdated"]),l(S,{ref:"deleteRoleModal",onDeleted:i.onRoleDeleted},null,8,["onDeleted"]),l(T,{ref:"deleteRolesModal",onDeleted:i.onRolesDeleted},null,8,["onDeleted"])])}const Ve=K(Z,[["render",_e]]);export{Ve as default};
