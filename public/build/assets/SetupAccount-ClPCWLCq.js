import{L as S}from"./Logo-DHNFLybf.js";import{c as n,b as d,a as t,k as p,n as _,o as a,e as k,t as c,d as u,r as h,F as E,w as y,i as C,j as b}from"./app-DB903dGk.js";import{_ as x}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{I as T}from"./Input-BL7OSBt_.js";import{B as P}from"./Button-MYDuztI5.js";import{L as B}from"./log-in-CBofvHec.js";import"./createLucideIcon-DIXLg_3g.js";import"./Tooltip-CiqB0ikv.js";import"./mail-BQRDUCKB.js";const I={props:{type:{type:String,default:"light",validator:s=>["light","primary","success","warning","danger"].includes(s)},title:{type:String,default:"Alert Title"},description:{type:String,default:""},dismissable:{type:Boolean,default:!0},showIcon:{type:Boolean,default:!0}},data(){return{visible:!0}},computed:{alertClass(){const s={light:"bg-gray-50 border-gray-200 text-gray-800 dark:bg-gray-800/10 dark:border-gray-700 dark:text-gray-500",primary:"bg-blue-50 border-blue-200 text-blue-800 dark:bg-blue-800/10 dark:border-blue-900 dark:text-blue-500",success:"bg-green-50 border-green-200 text-green-800 dark:bg-green-800/10 dark:border-green-900 dark:text-green-500",warning:"bg-yellow-50 border-yellow-200 text-yellow-800 dark:bg-yellow-800/10 dark:border-yellow-900 dark:text-yellow-500",danger:"bg-red-50 border-red-200 text-red-800 dark:bg-red-800/10 dark:border-red-900 dark:text-red-500"};return s[this.type]||s.light}}},j={key:0,class:"shrink-0"},F={key:0,class:"shrink-0 size-4 mt-0.5",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},V={key:1,class:"shrink-0 size-4 mt-0.5",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},z={key:2,class:"shrink-0 size-4 mt-0.5",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},L={key:3,class:"shrink-0 size-4 mt-0.5",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},A={key:4,class:"shrink-0 size-4 mt-0.5",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},M={class:"ms-4"},N={id:"alert-label",class:"text-sm font-semibold"},q={key:0,class:"mt-1 text-sm"};function U(s,e,o,i,r,l){return r.visible?(a(),n("div",{key:0,class:_(["flex p-4 rounded-lg text-sm border",l.alertClass]),role:"alert",tabindex:"-1","aria-labelledby":"alert-label"},[o.showIcon?(a(),n("div",j,[o.type=="light"?(a(),n("svg",F,e[1]||(e[1]=[t("circle",{cx:"12",cy:"12",r:"10"},null,-1),t("path",{d:"M12 16v-4"},null,-1),t("path",{d:"M12 8h.01"},null,-1)]))):d("",!0),o.type=="primary"?(a(),n("svg",V,e[2]||(e[2]=[t("circle",{cx:"12",cy:"12",r:"10"},null,-1),t("path",{d:"M12 16v-4"},null,-1),t("path",{d:"M12 8h.01"},null,-1)]))):d("",!0),o.type=="success"?(a(),n("svg",z,e[3]||(e[3]=[t("path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"},null,-1),t("path",{d:"m9 12 2 2 4-4"},null,-1)]))):o.type=="warning"?(a(),n("svg",L,e[4]||(e[4]=[t("path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"},null,-1),t("path",{d:"M12 9v4"},null,-1),t("path",{d:"M12 17h.01"},null,-1)]))):o.type=="danger"?(a(),n("svg",A,e[5]||(e[5]=[t("circle",{cx:"12",cy:"12",r:"10"},null,-1),t("path",{d:"m15 9-6 6"},null,-1),t("path",{d:"m9 9 6 6"},null,-1)]))):d("",!0)])):d("",!0),t("div",M,[t("h3",N,[p(s.$slots,"title",{},()=>[k(c(o.title),1)])]),o.description?(a(),n("div",q,[p(s.$slots,"description",{},()=>[k(c(o.description),1)])])):d("",!0)]),o.dismissable?(a(),n("button",{key:1,onClick:e[0]||(e[0]=f=>r.visible=!1),class:"ms-auto flex items-center justify-center size-5 rounded-lg border border-transparent text-gray-500 hover:bg-gray-100 hover:text-gray-800 focus:outline-none dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"},e[6]||(e[6]=[t("span",{class:"sr-only"},"Close",-1),t("svg",{class:"size-3",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M18 6 6 18"}),t("path",{d:"m6 6 12 12"})],-1)]))):d("",!0)],2)):d("",!0)}const Y=x(I,[["render",U]]),H={name:"SetupAccount",components:{Logo:S,Alert:Y,Input:T,Button:P},inject:["authState","formState","notificationState"],data(){return{LogIn:B,form:{email:"",token:"",password:"",confirmPassword:""},loading:!1,tokenError:null,currentYear:new Date().getFullYear()}},methods:{goHome(){this.$router.push({name:"login"})},async validateToken(){var s,e;try{await b.post("/api/auth/validate-token",{email:this.form.email,token:this.form.token}),this.tokenError=null}catch(o){const i=((e=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:e.message)||(o==null?void 0:o.message)||"Invalid or expired token.";this.tokenError=i,this.notificationState.showWarningNotification(i)}},async submit(){var s,e,o;if(!this.loading&&(this.formState.hideFormErrors(),this.form.email.trim()===""&&this.formState.setFormError("email","Email is required"),this.form.password.trim()===""&&this.formState.setFormError("password","Password is required"),this.form.confirmPassword.trim()===""&&this.formState.setFormError("confirmPassword","Confirm Password is required"),this.form.password!==this.form.confirmPassword&&this.formState.setFormError("confirmPassword","Passwords do not match"),!this.formState.hasErrors)){this.loading=!0;try{const r=(s=(await b.post("/api/auth/setup-password",this.form)).data)==null?void 0:s.token;if(r)this.authState.token=r,this.authState.setTokenOnLocalStorage(r),this.authState.setTokenOnRequest(r),await this.authState.fetchUser(),this.$router.push({name:"show-home"}),this.notificationState.showSuccessNotification("Password set successfully. You are now logged in.");else throw new Error("Token not received from server")}catch(i){const r=((o=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:o.message)||(i==null?void 0:i.message)||"Something went wrong while setting your password";this.formState.setServerFormErrors(i),this.notificationState.showWarningNotification(r),console.error("Failed to set password:",i)}finally{this.loading=!1}}}},async mounted(){this.form.email=this.$route.query.email||"",this.form.token=this.$route.query.token||"",this.form.email&&this.form.token?await this.validateToken():(this.tokenError="Invalid or missing email/token.",this.notificationState.showWarningNotification("Invalid or missing email/token."))}},W={class:"min-h-screen grid grid-cols-1 lg:grid-cols-2 transition-opacity opacity-100 duration-750 lg:grow starting:opacity-0"},D={class:"flex items-center justify-center p-6 bg-slate-100"},O={class:"w-full max-w-md"},G={class:"flex justify-center mb-6"},R={class:"bg-white rounded-lg shadow-sm border border-slate-200 p-6 mb-6"},Z={class:"text-2xl font-semibold leading-none tracking-tight mb-4"},J={class:"text-sm text-gray-500 mb-4"},K={key:0,class:"text-red-500 text-sm mb-3"},Q={class:"ml-1"},X={class:"text-sm text-center text-gray-500"};function $(s,e,o,i,r,l){const f=h("Logo"),v=h("Alert"),w=h("Button"),g=h("Input");return a(),n("div",W,[t("div",D,[t("div",O,[t("div",G,[u(f,{height:"h-10"})]),t("div",R,[t("h1",Z,c(r.tokenError?r.tokenError.includes("expired")?"Setup Link Expired":"Setup Link Invalid":"Set Up Your Account"),1),t("h1",J,c(r.tokenError?r.tokenError.includes("expired")?"The link to set up your account has expired. Contact your administrator to assist.":"The link to set up your account is invalid. Contact your administrator to assist.":"Please set your password to activate your account."),1),r.tokenError?(a(),n(E,{key:0},[u(v,{title:r.tokenError,type:"danger",dismissable:!1,class:"mb-8"},null,8,["title"]),u(w,{type:"primary",size:"lg",action:l.goHome,class:"w-full"},{default:y(()=>e[4]||(e[4]=[t("span",null,"Go Home",-1)])),_:1},8,["action"])],64)):(a(),n("form",{key:1,onSubmit:e[3]||(e[3]=C((...m)=>l.submit&&l.submit(...m),["prevent"])),class:"space-y-4"},[u(g,{type:"email",label:"Email",modelValue:r.form.email,"onUpdate:modelValue":e[0]||(e[0]=m=>r.form.email=m),errorText:l.formState.getFormError("email"),disabled:""},null,8,["modelValue","errorText"]),u(g,{type:"password",label:"Password",modelValue:r.form.password,"onUpdate:modelValue":e[1]||(e[1]=m=>r.form.password=m),errorText:l.formState.getFormError("password")},null,8,["modelValue","errorText"]),u(g,{type:"password",label:"Confirm Password",modelValue:r.form.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=m=>r.form.confirmPassword=m),errorText:l.formState.getFormError("confirmPassword")},null,8,["modelValue","errorText"]),l.formState.generalErrorText?(a(),n("div",K,c(l.formState.generalErrorText),1)):d("",!0),u(w,{size:"md",type:"primary",class:"w-full",action:l.submit,leftIcon:r.LogIn,disabled:r.loading},{default:y(()=>[t("span",Q,c(r.loading?"Setting Password...":"Set Password"),1)]),_:1},8,["action","leftIcon","disabled"])],32))]),t("p",X,"Â© "+c(r.currentYear)+" Telcoflo. All rights reserved.",1)])]),e[5]||(e[5]=t("div",{class:"hidden lg:block"},[t("img",{src:"/images/smiling-customer-service-agent.jpg",class:"w-full h-full object-cover",alt:"Customer service agent"})],-1))])}const de=x(H,[["render",$]]);export{de as default};
