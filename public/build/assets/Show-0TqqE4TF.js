import{c as n,d as r,F as u,a as t,r as m,w as f,j as S,G as M,o as i,h as y,n as C,i as I,b as h,t as g}from"./app-Du355Hwa.js";import{T as R,M as N,P as A,i as F,a as b}from"./Table-Ukz-LVMs.js";import{P as L,I as U}from"./Input-Ce6sOWCE.js";import{B as V}from"./Button-QuQuG-sh.js";import{f as j,a as B,D as q}from"./dateUtils-BxSzW5yy.js";import{D as O,a as W}from"./DeleteCallFlowsModal-oxODLERx.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{W as Y}from"./workflow-C1bTHwzT.js";import{P as H}from"./pencil-CpKEG2hD.js";import{P as J}from"./plus-Cw5wWZrK.js";import"./createLucideIcon-CQR3ABw7.js";import"./Tooltip-Bh561etO.js";import"./Drawer-EX-MXofE.js";import"./arrow-up-CiGeyIVi.js";import"./Switch-C9_nwvxw.js";import"./vue-draggable-next.esm-bundler-Bt-FJ2_7.js";import"./mail-CmabDzCr.js";const K={inject:["formState","notificationState"],components:{Pill:A,Modal:N,Input:U,Button:V,Popover:L,Dropdown:q,Table:R,DeleteCallFlowModal:W,DeleteCallFlowsModal:O,WorkflowIcon:Y},data(){return{Plus:J,Pencil:H,Trash2:b,perPage:"15",callFlows:[],getCountryName:M,checkedRows:[],pagination:null,searchTerm:null,selectAll:!1,filterExpressions:[],sortingExpressions:[],isLoadingCallFlows:!1,columns:this.prepareColumns(),dropdownOptions:[{icon:b,label:"Delete",action:this.showDeleteCallFlowsModal}]}},watch:{selectAll(s){this.checkedRows=this.callFlows.reduce((e,c)=>(e[c.id]=s,e),{})}},computed:{hasSearchTerm(){return this.searchTerm!=null&&this.searchTerm.trim()!==""},totalCheckedRows(){return Object.values(this.checkedRows).filter(Boolean).length},hasFilterExpressions(){return this.filterExpressions.length>0},hasSortingExpressions(){return this.sortingExpressions.length>0},showTable(){var s;return this.isLoadingCallFlows||((s=(this.pagination??{}).meta)==null?void 0:s.total)>0||this.hasSearchTerm||this.hasFilterExpressions||this.hasSortingExpressions}},methods:{formattedDatetime:B,formattedRelativeDate:j,prepareColumns(){const s=["Name","Organization","Country","Numbers","Created Date"],e=["Name","Organization","Country","Numbers","Created Date"];return s.map(c=>({name:c,active:e.includes(c),priority:e.includes(c)}))},navigateToCreateCallFlow(){this.$router.push({name:"create-call-flow"})},showDeleteCallFlowModal(s){this.$refs.deleteCallFlowModal.showModal(s)},showDeleteCallFlowsModal(){const s=this.callFlows.filter(e=>this.checkedRows[e.id]).map(e=>e.id);this.$refs.deleteCallFlowsModal.showModal(s)},onCallFlowDeleted(s){this.callFlows=this.callFlows.filter(e=>e.id!==s),this.callFlows.length===0&&this.fetchCallFlows()},onCallFlowsDeleted(s=[]){s.forEach(e=>{this.checkedRows[e]!==void 0&&(this.checkedRows[e]=!1)}),this.selectAll=!1,this.callFlows=this.callFlows.filter(e=>!s.includes(e.id)),this.callFlows.length===0&&this.fetchCallFlows()},paginate(s){this.fetchCallFlows(s)},search(s){this.searchTerm=s,this.fetchCallFlows()},updatedColumns(s){this.columns=s},updatedFilters(s){const e=s.map(c=>c.expression);F(this.filterExpressions,e)||(this.filterExpressions=e,this.fetchCallFlows())},updatedSorting(s){const e=s.map(c=>c.expression);F(this.sortingExpressions,e)||(this.sortingExpressions=e,this.fetchCallFlows())},updatedPerPage(s){this.perPage=s,this.fetchCallFlows()},async fetchCallFlows(s=null){var e,c;try{this.isLoadingCallFlows=!0,s=s??"/api/call-flows";let d={params:{per_page:this.perPage,_relationships:"organization",_countable_relationships:"numbers"}};this.hasSearchTerm&&(d.params.search=this.searchTerm),this.hasFilterExpressions&&(d.params._filters=this.filterExpressions.join("|")),this.hasSortingExpressions&&(d.params._sort=this.sortingExpressions.join("|"));const o=await S.get(s,d);this.pagination=o.data,this.callFlows=this.pagination.data,this.checkedRows=this.callFlows.reduce((a,w)=>(a[w.id]=!1,a),{})}catch(d){const o=((c=(e=d==null?void 0:d.response)==null?void 0:e.data)==null?void 0:c.message)||(d==null?void 0:d.message)||"Something went wrong while fetching call flows";this.$notificationState.showWarningNotification(o),console.error("Failed to fetch call flows:",d)}finally{this.isLoadingCallFlows=!1}}},created(){this.isLoadingCallFlows=!0,this.searchTerm=this.$route.query.searchTerm,this.$route.query.filterExpressions&&(this.filterExpressions=this.$route.query.filterExpressions.split("|")),this.$route.query.sortingExpressions&&(this.sortingExpressions=this.$route.query.sortingExpressions.split("|")),this.fetchCallFlows()}},Q={class:"select-none min-h-screen bg-gray-50 pt-8 p-4 sm:p-8 space-y-4 sm:space-y-6"},X={class:"flex justify-between"},Z={class:"flex items-end space-x-2"},$={class:"flex justify-end"},ee={class:"border-b border-indigo-200"},se={scope:"col",class:"whitespace-nowrap align-top font-semibold px-4 py-2.5"},te={key:0,class:"whitespace-nowrap align-center pr-4 py-4"},oe={key:1,class:"whitespace-nowrap align-center pr-4 py-4"},le={key:0,class:"flex items-center space-x-2"},ae={class:"whitespace-nowrap"},ne={key:2,class:"whitespace-nowrap align-center pr-4 py-4"},ie={key:0,class:"flex items-center space-x-2"},re={class:"flex items-center space-x-2"},ce=["src","alt"],de={key:3,class:"whitespace-nowrap align-center text-center pr-4 py-4"},pe={key:4,class:"whitespace-nowrap align-center pr-4 py-4"},he={class:"flex space-x-1 items-center"},me={class:"h-16 pr-4 py-4 flex align-middle items-center space-x-2"},ue={key:1,class:"select-none w-full flex justify-center py-16"},fe={class:"max-w-sm w-full bg-white shadow-sm rounded-xl p-6 flex flex-col items-center text-center space-y-4 border border-dashed border-gray-200"};function ge(s,e,c,d,o,a){const w=m("WorkflowIcon"),x=m("Button"),k=m("Dropdown"),_=m("Input"),D=m("Popover"),E=m("router-link"),v=m("Table"),P=m("DeleteCallFlowModal"),T=m("DeleteCallFlowsModal");return i(),n("div",Q,[a.showTable?(i(),n(u,{key:0},[t("div",X,[t("div",Z,[r(w,{size:"48","stroke-width":"1",class:"text-gray-400"}),e[2]||(e[2]=t("div",null,[t("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white"},"Call Flows"),t("p",{class:"text-sm text-gray-600 dark:text-neutral-400"}," Manage call flows within your organization ")],-1))]),t("div",$,[r(x,{type:"primary",size:"md",leftIcon:o.Plus,leftIconSize:"20",action:a.navigateToCreateCallFlow},{default:f(()=>e[3]||(e[3]=[t("span",null,"Add Call Flow",-1)])),_:1},8,["leftIcon","action"])])]),r(v,{onSearch:a.search,columns:o.columns,perPage:o.perPage,onPaginate:a.paginate,resource:"call-flows",onRefresh:a.fetchCallFlows,searchTerm:o.searchTerm,pagination:o.pagination,onUpdatedColumns:a.updatedColumns,onUpdatedFilters:a.updatedFilters,onUpdatedSorting:a.updatedSorting,onUpdatedPerPage:a.updatedPerPage,isLoading:o.isLoadingCallFlows,filterExpressions:o.filterExpressions,sortingExpressions:o.sortingExpressions},{belowToolbar:f(()=>[t("div",{class:C([{hidden:a.totalCheckedRows===0},"bg-gray-50 border flex items-center mb-2 p-4 rounded-lg shadow space-x-2"])},[e[4]||(e[4]=t("span",{class:"text-sm"},"Actions: ",-1)),r(k,{triggerSize:"sm",options:o.dropdownOptions,triggerText:`Select Action (${a.totalCheckedRows} selected)`},null,8,["options","triggerText"])],2)]),head:f(()=>[t("tr",ee,[t("th",se,[r(_,{type:"checkbox",modelValue:o.selectAll,"onUpdate:modelValue":e[0]||(e[0]=l=>o.selectAll=l)},null,8,["modelValue"])]),(i(!0),n(u,null,y(o.columns,(l,p)=>(i(),n(u,{key:p},[l.active?(i(),n("th",{key:0,scope:"col",class:C(["whitespace-nowrap align-top font-semibold pr-4 py-2.5",{"text-center":["Numbers"].includes(l.name)}])},g(l.name),3)):h("",!0)],64))),128)),e[5]||(e[5]=t("th",{scope:"col",class:"whitespace-nowrap align-top font-semibold pr-4 py-2.5"},"Actions",-1))])]),body:f(()=>[(i(!0),n(u,null,y(o.callFlows,l=>(i(),n("tr",{key:l.id,class:C([o.checkedRows[l.id]?"bg-blue-50":"bg-white hover:bg-gray-50","group cursor-pointer text-sm border-b border-gray-200"])},[t("td",{onClick:e[1]||(e[1]=I(()=>{},["stop"])),class:"whitespace-nowrap align-top px-4 py-4"},[r(_,{type:"checkbox",modelValue:o.checkedRows[l.id],"onUpdate:modelValue":p=>o.checkedRows[l.id]=p},null,8,["modelValue","onUpdate:modelValue"])]),(i(!0),n(u,null,y(o.columns,(p,z)=>(i(),n(u,{key:z},[p.active?(i(),n(u,{key:0},[p.name==="Name"?(i(),n("td",te,[t("div",null,g(l.name),1)])):h("",!0),p.name==="Organization"?(i(),n("td",oe,[l.organization?(i(),n("div",le,[e[6]||(e[6]=t("img",{src:"https://placehold.co/21x24",class:"size-8 rounded-lg shrink-0",alt:"Logo"},null,-1)),t("div",ae,g(l.organization.name),1)])):h("",!0)])):h("",!0),p.name==="Country"?(i(),n("td",ne,[l.organization?(i(),n("div",ie,[t("div",re,[l.organization.country?(i(),n("img",{key:0,src:`/svgs/country-flags/${l.organization.country.toLowerCase()}.svg`,alt:l.organization.country,class:"w-5 h-4 rounded-sm object-cover"},null,8,ce)):h("",!0),t("span",null,g(o.getCountryName(l.organization.country)),1)])])):h("",!0)])):h("",!0),p.name==="Numbers"?(i(),n("td",de,[t("span",null,g(l.numbers_count),1)])):h("",!0),p.name==="Created Date"?(i(),n("td",pe,[t("div",he,[t("span",null,g(a.formattedDatetime(l.created_at)),1),r(D,{placement:"top",class:"opacity-0 group-hover:opacity-100",content:a.formattedRelativeDate(l.created_at)},null,8,["content"])])])):h("",!0)],64)):h("",!0)],64))),128)),t("td",me,[r(E,{to:{name:"edit-call-flow",params:{call_flow_id:l.id}}},{default:f(()=>[r(x,{type:"bare",size:"xs",leftIcon:o.Pencil,leftIconSize:"16"},null,8,["leftIcon"])]),_:2},1032,["to"]),r(x,{type:"bareDanger",size:"xs",leftIcon:o.Trash2,leftIconSize:"16",action:()=>a.showDeleteCallFlowModal(l)},null,8,["leftIcon","action"])])],2))),128))]),_:1},8,["onSearch","columns","perPage","onPaginate","onRefresh","searchTerm","pagination","onUpdatedColumns","onUpdatedFilters","onUpdatedSorting","onUpdatedPerPage","isLoading","filterExpressions","sortingExpressions"])],64)):(i(),n("div",ue,[t("div",fe,[r(w,{size:"48",class:"text-gray-400"}),e[8]||(e[8]=t("h2",{class:"text-2xl font-bold text-gray-800"},"No Call Flows Yet",-1)),e[9]||(e[9]=t("p",{class:"text-sm text-gray-500"},"Add a call flow to manage call routing.",-1)),r(x,{type:"primary",size:"md",leftIcon:o.Plus,leftIconSize:"20",action:a.navigateToCreateCallFlow},{default:f(()=>e[7]||(e[7]=[t("span",null,"Add Call Flow",-1)])),_:1},8,["leftIcon","action"])])])),r(P,{ref:"deleteCallFlowModal",onDeleted:a.onCallFlowDeleted},null,8,["onDeleted"]),r(T,{ref:"deleteCallFlowsModal",onDeleted:a.onCallFlowsDeleted},null,8,["onDeleted"])])}const Re=G(K,[["render",ge]]);export{Re as default};
