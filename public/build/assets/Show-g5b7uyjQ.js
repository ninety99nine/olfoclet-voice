import{j as M,m as w,w as c,r as d,o as r,a as i,d as l,b as m,c as p,t as u,F as C,h as L,n as D,i as z}from"./app-DB903dGk.js";import{M as S,a as b,T as W,P as O,i as N}from"./Table-C_6oH8I7.js";import{I as B,P as Y}from"./Input-BL7OSBt_.js";import{B as I}from"./Button-MYDuztI5.js";import{f as G,a as H,D as J}from"./dateUtils-CA0ranRn.js";import{L as E}from"./loader-DeCjsEU3.js";import{P as F}from"./pencil-DOMdoccY.js";import{_ as k}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as U}from"./message-square-more-mbI6sl1q.js";import{B as K}from"./bot-C_N1pDzA.js";import{P as Q}from"./plus-xzKPLU_4.js";import"./createLucideIcon-DIXLg_3g.js";import"./Tooltip-CiqB0ikv.js";import"./Drawer-CZjGLGn_.js";import"./arrow-up-B1IjiNg6.js";import"./Switch-C8ssyrhM.js";import"./vue-draggable-next.esm-bundler-C4jc-Uhl.js";import"./mail-BQRDUCKB.js";const X={components:{Modal:S,Input:B,Button:I,Loader:E,Pencil:F},inject:["formState","notificationState"],data(){return{thread:null,form:{title:""},errors:{title:null},isLoading:!1}},methods:{showModal(t){this.thread=t,this.form.title=t.title||"",this.$refs.modal.showModal()},hideModal(){this.$refs.modal.hideModal()},clearError(t){this.errors[t]=null},async updateThread(){var t,e,s;if(this.thread)try{this.isLoading=!0,this.errors={title:null},(await M.put(`/api/conversation-threads/${this.thread.id}`,{title:this.form.title})).data.updated?(this.notificationState.showSuccessNotification("Conversation thread updated successfully"),this.$emit("updated",{...this.thread,title:this.form.title}),this.hideModal()):this.notificationState.showWarningNotification("Failed to update conversation thread")}catch(n){if(((t=n.response)==null?void 0:t.status)===422){const o=n.response.data.errors;o.title&&(this.errors.title=o.title[0])}else{const o=((s=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:s.message)||(n==null?void 0:n.message)||"Failed to update conversation thread";this.notificationState.showWarningNotification(o),console.error("Failed to update conversation thread:",n)}}finally{this.isLoading=!1}},onClose(){this.thread=null,this.form.title="",this.errors={title:null},this.isLoading=!1}}},Z={class:"flex items-center space-x-2"},$={class:"space-y-4"},ee={key:0,class:"mt-1 text-sm text-red-600"},te={class:"flex justify-end space-x-2"};function se(t,e,s,n,o,a){const g=d("Pencil"),x=d("Input"),f=d("Button"),T=d("Loader"),_=d("Modal");return r(),w(_,{ref:"modal",onClosed:a.onClose},{header:c(()=>[i("div",Z,[l(g,{size:"24",class:"text-indigo-500"}),e[2]||(e[2]=i("h3",{class:"text-lg font-semibold text-gray-900"},"Update Conversation Thread",-1))])]),body:c(()=>[i("div",$,[i("div",null,[e[3]||(e[3]=i("label",{for:"title",class:"block text-sm font-medium text-gray-700"},"Title",-1)),l(x,{id:"title",type:"text",modelValue:o.form.title,"onUpdate:modelValue":e[0]||(e[0]=v=>o.form.title=v),placeholder:"Enter thread title",disabled:o.isLoading,class:"mt-1 w-full",onInput:e[1]||(e[1]=v=>a.clearError("title"))},null,8,["modelValue","disabled"]),o.errors.title?(r(),p("p",ee,u(o.errors.title),1)):m("",!0)])])]),footer:c(()=>[i("div",te,[l(f,{type:"light",size:"md",action:a.hideModal},{default:c(()=>e[4]||(e[4]=[i("span",null,"Cancel",-1)])),_:1},8,["action"]),l(f,{type:"primary",size:"md",action:a.updateThread,disabled:o.isLoading},{default:c(()=>[o.isLoading?(r(),w(T,{key:0,size:"20",class:"animate-spin mr-2"})):m("",!0),e[5]||(e[5]=i("span",null,"Update",-1))]),_:1},8,["action","disabled"])])]),_:1},8,["onClosed"])}const oe=k(X,[["render",se]]),ie={components:{Modal:S,Button:I,Loader:E,Trash2:b},inject:["notificationState"],data(){return{thread:null,isLoading:!1}},methods:{showModal(t){this.thread=t,this.$refs.modal.showModal()},hideModal(){this.$refs.modal.hideModal()},async deleteThread(){var t,e;if(this.thread)try{this.isLoading=!0;const s=await M.delete("/api/conversation-threads",{data:{thread_ids:[this.thread.id]}});s.data.deleted?(this.notificationState.showSuccessNotification(s.data.message),this.$emit("deleted",this.thread.id),this.hideModal()):this.notificationState.showWarningNotification(s.data.message)}catch(s){const n=((e=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:e.message)||(s==null?void 0:s.message)||"Failed to delete conversation thread";this.notificationState.showWarningNotification(n),console.error("Failed to delete conversation thread:",s)}finally{this.isLoading=!1}},onClose(){this.thread=null,this.isLoading=!1}}},ae={class:"flex items-center space-x-2"},ne={class:"space-y-4"},re={class:"text-sm text-gray-600"},le={class:"flex justify-end space-x-2"};function de(t,e,s,n,o,a){const g=d("Trash2"),x=d("Button"),f=d("Loader"),T=d("Modal");return r(),w(T,{ref:"modal",onClosed:a.onClose},{header:c(()=>[i("div",ae,[l(g,{size:"24",class:"text-red-500"}),e[0]||(e[0]=i("h3",{class:"text-lg font-semibold text-gray-900"},"Delete Conversation Thread",-1))])]),body:c(()=>{var _;return[i("div",ne,[i("p",re,' Are you sure you want to delete the conversation thread titled "'+u((_=o.thread)==null?void 0:_.title)+'"? This action cannot be undone. ',1)])]}),footer:c(()=>[i("div",le,[l(x,{type:"light",size:"md",action:a.hideModal},{default:c(()=>e[1]||(e[1]=[i("span",null,"Cancel",-1)])),_:1},8,["action"]),l(x,{type:"danger",size:"md",action:a.deleteThread,disabled:o.isLoading},{default:c(()=>[o.isLoading?(r(),w(f,{key:0,size:"20",class:"animate-spin mr-2"})):m("",!0),e[2]||(e[2]=i("span",null,"Delete",-1))]),_:1},8,["action","disabled"])])]),_:1},8,["onClosed"])}const ce=k(ie,[["render",de]]),he={components:{Modal:S,Button:I,Loader:E,Trash2:b},inject:["notificationState"],data(){return{threadIds:[],isLoading:!1}},methods:{showModal(t){this.threadIds=t,this.$refs.modal.showModal()},hideModal(){this.$refs.modal.hideModal()},async deleteThreads(){var t,e;if(!(!this.threadIds||this.threadIds.length===0))try{this.isLoading=!0;const s=await M.delete("/api/conversation-threads",{data:{thread_ids:this.threadIds}});s.data.deleted?(this.notificationState.showSuccessNotification(s.data.message),this.$emit("deleted",this.threadIds),this.hideModal()):this.notificationState.showWarningNotification(s.data.message)}catch(s){const n=((e=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:e.message)||(s==null?void 0:s.message)||"Failed to delete conversation threads";this.notificationState.showWarningNotification(n),console.error("Failed to delete conversation threads:",s)}finally{this.isLoading=!1}},onClose(){this.threadIds=[],this.isLoading=!1}}},pe={class:"flex items-center space-x-2"},me={class:"space-y-4"},fe={class:"text-sm text-gray-600"},ue={class:"flex justify-end space-x-2"};function ge(t,e,s,n,o,a){const g=d("Trash2"),x=d("Button"),f=d("Loader"),T=d("Modal");return r(),w(T,{ref:"modal",onClosed:a.onClose},{header:c(()=>[i("div",pe,[l(g,{size:"24",class:"text-red-500"}),e[0]||(e[0]=i("h3",{class:"text-lg font-semibold text-gray-900"},"Delete Conversation Threads",-1))])]),body:c(()=>{var _,v;return[i("div",me,[i("p",fe," Are you sure you want to delete "+u(((_=o.threadIds)==null?void 0:_.length)||0)+" conversation thread"+u(((v=o.threadIds)==null?void 0:v.length)===1?"":"s")+"? This action cannot be undone. ",1)])]}),footer:c(()=>[i("div",ue,[l(x,{type:"light",size:"md",action:a.hideModal},{default:c(()=>e[1]||(e[1]=[i("span",null,"Cancel",-1)])),_:1},8,["action"]),l(x,{type:"danger",size:"md",action:a.deleteThreads,disabled:o.isLoading},{default:c(()=>[o.isLoading?(r(),w(f,{key:0,size:"20",class:"animate-spin mr-2"})):m("",!0),e[2]||(e[2]=i("span",null,"Delete",-1))]),_:1},8,["action","disabled"])])]),_:1},8,["onClosed"])}const xe=k(he,[["render",ge]]),_e={props:{copilotId:{type:String,default:null}},inject:["formState","notificationState"],components:{BotIcon:K,Pill:O,Modal:S,Input:B,Button:I,Popover:Y,Dropdown:J,Table:W,UpdateConversationThreadModal:oe,DeleteConversationThreadModal:ce,DeleteConversationThreadsModal:xe,MessageSquareMoreIcon:U},data(){return{Plus:Q,Pencil:F,Trash2:b,copilot:null,threads:[],perPage:"15",checkedRows:[],pagination:null,searchTerm:null,selectAll:!1,filterExpressions:[],MessageSquareMoreIcon:U,sortingExpressions:[],isLoadingThreads:!1,isLoadingCopilot:!1,columns:this.prepareColumns(),dropdownOptions:[{icon:b,label:"Delete",action:this.showDeleteThreadsModal}]}},watch:{selectAll(t){this.checkedRows=this.threads.reduce((e,s)=>(e[s.id]=t,e),{})}},computed:{hasSearchTerm(){return this.searchTerm!=null&&this.searchTerm.trim()!=""},totalCheckedRows(){return Object.values(this.checkedRows).filter(t=>t).length},hasFilterExpressions(){return this.filterExpressions.length>0},hasSortingExpressions(){return this.sortingExpressions.length>0},showTable(){var t;return this.isLoadingThreads||((t=(this.pagination??{}).meta)==null?void 0:t.total)>0||this.hasSearchTerm||this.hasFilterExpressions||this.hasSortingExpressions}},methods:{formattedDatetime:H,formattedRelativeDate:G,prepareColumns(){const t=["Title","Copilot","Messages","Created Date"],e=["Title","Messages","Created Date"];return this.copilotId||e.splice(1,0,"Copilot"),t.map(s=>({name:s,active:e.includes(s),priority:e.includes(s)}))},showUpdateThreadModal(t){this.$refs.updateThreadModal.showModal(t)},showDeleteThreadModal(t){this.$refs.deleteThreadModal.showModal(t)},showDeleteThreadsModal(){const t=this.threads.filter(e=>this.checkedRows[e.id]).map(e=>e.id);this.$refs.deleteThreadsModal.showModal(t)},onThreadUpdated(t){this.threads=this.threads.map(e=>e.id===t.id?{...e,...t}:e)},onThreadDeleted(t){this.threads=this.threads.filter(e=>e.id!==t),this.threads.length===0&&this.fetchThreads()},onThreadsDeleted(t=[]){t.forEach(e=>{this.checkedRows[e]!==void 0&&(this.checkedRows[e]=!1)}),this.selectAll=!1,this.threads=this.threads.filter(e=>!t.includes(e.id)),this.threads.length===0&&this.fetchThreads()},paginate(t){this.fetchThreads(t)},search(t){this.searchTerm=t,this.fetchThreads()},updatedColumns(t){this.columns=t},updatedFilters(t){const e=t.map(s=>s.expression);N(this.filterExpressions,e)||(this.filterExpressions=e,this.fetchThreads())},updatedSorting(t){const e=t.map(s=>s.expression);N(this.sortingExpressions,e)||(this.sortingExpressions=e,this.fetchThreads())},updatedPerPage(t){this.perPage=t,this.fetchThreads()},onView(t){if(!t.copilot||!t.copilot.id){this.notificationState.showWarningNotification("Cannot open thread: Copilot information is missing.");return}this.$router.push({name:"chat-copilot-conversation-thread",params:{copilotId:t.copilot.id,conversationThreadId:t.id}})},startNewConversation(){this.$router.push({name:"create-copilot-conversation-thread",params:{copilotId:this.copilotId}})},async fetchCopilot(){var t,e;if(this.copilotId)try{this.isLoadingCopilot=!0;const s=await M.get(`/api/copilots/${this.copilotId}`,{params:{_relationships:"organization,users,knowledgeBases"}});this.copilot=s.data}catch(s){const n=((e=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:e.message)||(s==null?void 0:s.message)||"Failed to load Copilot";this.notificationState.showWarningNotification(n),console.error("Failed to fetch copilot:",s)}finally{this.isLoadingCopilot=!1}},async fetchThreads(t=null){var e,s;try{this.isLoadingThreads=!0,t=t??"/api/conversation-threads";let n={params:{per_page:this.perPage,_relationships:"copilot"}};this.copilotId&&(n.params.copilot_id=this.copilotId),this.hasSearchTerm&&(n.params.search=this.searchTerm),this.hasFilterExpressions&&(n.params._filters=this.filterExpressions.join("|")),this.hasSortingExpressions&&(n.params._sort=this.sortingExpressions.join("|"));const o=await M.get(t,n);this.pagination=o.data,this.threads=this.pagination.data,this.checkedRows=this.threads.reduce((a,g)=>(a[g.id]=!1,a),{})}catch(n){const o=((s=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:s.message)||(n==null?void 0:n.message)||"Something went wrong while fetching conversation threads";this.notificationState.showWarningNotification(o),console.error("Failed to fetch conversation threads:",n)}finally{this.isLoadingThreads=!1}}},created(){this.isLoadingThreads=!0,this.searchTerm=this.$route.query.searchTerm,this.$route.query.filterExpressions&&(this.filterExpressions=this.$route.query.filterExpressions.split("|")),this.$route.query.sortingExpressions&&(this.sortingExpressions=this.$route.query.sortingExpressions.split("|")),this.fetchCopilot(),this.fetchThreads()}},ye={class:"select-none min-h-screen bg-gray-50 pt-8 p-4 sm:p-8 space-y-4 sm:space-y-6"},we={class:"flex justify-between"},Te={class:"flex items-end space-x-2"},ve={key:0,class:"flex items-center space-x-2"},Ce={class:"flex items-center space-x-1 bg-indigo-50 px-2 py-1 border border-dashed border-indigo-200 text-indigo-500 rounded-sm text-xs"},Me={key:1,class:"text-sm text-gray-600 dark:text-neutral-400"},be={class:"flex justify-end"},Se={class:"border-b border-indigo-200"},Ie={scope:"col",class:"whitespace-nowrap align-top font-semibold px-4 py-2.5"},ke=["onClick"],Le={key:0,class:"whitespace-nowrap align-center pr-4 py-4"},De={key:1,class:"whitespace-nowrap align-center pr-4 py-4"},Ee={key:0,class:"flex items-center space-x-2"},Pe={class:"whitespace-nowrap"},ze={key:2,class:"whitespace-nowrap align-center text-center pr-4 py-4"},Ne={key:3,class:"whitespace-nowrap align-center pr-4 py-4"},Ue={class:"flex space-x-1 items-center"},Be={class:"h-16 pr-4 py-4 flex align-middle items-center space-x-2"},Fe={key:1,class:"select-none w-full flex justify-center py-16"},Re={class:"max-w-sm w-full bg-white shadow-sm rounded-xl p-6 flex flex-col items-center text-center space-y-4 border border-dashed border-gray-200"},Ve={class:"text-sm text-gray-500"};function je(t,e,s,n,o,a){var P;const g=d("MessageSquareMoreIcon"),x=d("BotIcon"),f=d("Button"),T=d("Dropdown"),_=d("Input"),v=d("Popover"),R=d("Table"),V=d("UpdateConversationThreadModal"),j=d("DeleteConversationThreadModal"),q=d("DeleteConversationThreadsModal");return r(),p("div",ye,[a.showTable?(r(),p(C,{key:0},[i("div",we,[i("div",Te,[l(g,{size:"48","stroke-width":"1",class:"text-gray-400"}),i("div",null,[e[3]||(e[3]=i("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white"},"Conversations",-1)),s.copilotId?(r(),p("div",ve,[e[2]||(e[2]=i("span",{class:"text-sm text-gray-600"},"Conversations with",-1)),i("div",Ce,[l(x,{size:"16"}),i("span",null,u(o.isLoadingCopilot?"...":o.copilot.name),1)])])):(r(),p("p",Me," View all your conversation threads "))])]),i("div",be,[s.copilotId?(r(),w(f,{key:0,type:"primary",size:"md",leftIcon:o.Plus,leftIconSize:"20",action:a.startNewConversation},{default:c(()=>e[4]||(e[4]=[i("span",null,"New Conversation",-1)])),_:1},8,["leftIcon","action"])):m("",!0)])]),l(R,{onSearch:a.search,columns:o.columns,perPage:o.perPage,onPaginate:a.paginate,onRefresh:a.fetchThreads,searchTerm:o.searchTerm,pagination:o.pagination,resource:"conversation-threads",onUpdatedColumns:a.updatedColumns,onUpdatedFilters:a.updatedFilters,onUpdatedSorting:a.updatedSorting,onUpdatedPerPage:a.updatedPerPage,filterExpressions:o.filterExpressions,sortingExpressions:o.sortingExpressions,isLoading:o.isLoadingCopilot||o.isLoadingThreads},{belowToolbar:c(()=>[i("div",{class:D([{hidden:a.totalCheckedRows===0},"bg-gray-50 border flex items-center mb-2 p-4 rounded-lg shadow space-x-2"])},[e[5]||(e[5]=i("span",{class:"text-sm"},"Actions: ",-1)),l(T,{triggerSize:"sm",options:o.dropdownOptions,triggerText:`Select Action (${a.totalCheckedRows} selected)`},null,8,["options","triggerText"])],2)]),head:c(()=>[i("tr",Se,[i("th",Ie,[l(_,{type:"checkbox",modelValue:o.selectAll,"onUpdate:modelValue":e[0]||(e[0]=h=>o.selectAll=h)},null,8,["modelValue"])]),(r(!0),p(C,null,L(o.columns,(h,y)=>(r(),p(C,{key:y},[h.active?(r(),p("th",{key:0,scope:"col",class:D(["whitespace-nowrap align-top font-semibold pr-4 py-2.5",{"text-center":["Messages"].includes(h.name)}])},u(h.name),3)):m("",!0)],64))),128)),e[6]||(e[6]=i("th",{scope:"col",class:"whitespace-nowrap align-top font-semibold pr-4 py-2.5"},"Actions",-1))])]),body:c(()=>[(r(!0),p(C,null,L(o.threads,h=>(r(),p("tr",{key:h.id,onClick:z(y=>a.onView(h),["stop"]),class:D([o.checkedRows[h.id]?"bg-blue-50":"bg-white hover:bg-gray-50","group cursor-pointer text-sm border-b border-gray-200"])},[i("td",{onClick:e[1]||(e[1]=z(()=>{},["stop"])),class:"whitespace-nowrap align-top px-4 py-4"},[l(_,{type:"checkbox",modelValue:o.checkedRows[h.id],"onUpdate:modelValue":y=>o.checkedRows[h.id]=y},null,8,["modelValue","onUpdate:modelValue"])]),(r(!0),p(C,null,L(o.columns,(y,A)=>(r(),p(C,{key:A},[y.active?(r(),p(C,{key:0},[y.name=="Title"?(r(),p("td",Le,[i("div",null,u(h.title),1)])):m("",!0),y.name=="Copilot"?(r(),p("td",De,[h.copilot?(r(),p("div",Ee,[l(x,{size:"20",class:"text-gray-400"}),i("div",Pe,u(h.copilot.name),1)])):m("",!0)])):m("",!0),y.name=="Messages"?(r(),p("td",ze,[i("span",null,u(h.messages_count||0),1)])):m("",!0),y.name=="Created Date"?(r(),p("td",Ne,[i("div",Ue,[i("span",null,u(a.formattedDatetime(h.created_at)),1),l(v,{placement:"top",class:"opacity-0 group-hover:opacity-100",content:a.formattedRelativeDate(h.created_at)},null,8,["content"])])])):m("",!0)],64)):m("",!0)],64))),128)),i("td",Be,[l(f,{type:"bare",size:"xs",leftIcon:o.Pencil,leftIconSize:"16",action:()=>a.showUpdateThreadModal(h)},null,8,["leftIcon","action"]),l(f,{type:"bareDanger",size:"xs",leftIcon:o.Trash2,leftIconSize:"16",action:()=>a.showDeleteThreadModal(h)},null,8,["leftIcon","action"])])],10,ke))),128))]),_:1},8,["onSearch","columns","perPage","onPaginate","onRefresh","searchTerm","pagination","onUpdatedColumns","onUpdatedFilters","onUpdatedSorting","onUpdatedPerPage","filterExpressions","sortingExpressions","isLoading"])],64)):(r(),p("div",Fe,[i("div",Re,[l(g,{size:"48",class:"text-gray-400"}),e[8]||(e[8]=i("h2",{class:"text-2xl font-bold text-gray-800"},"No Conversations Yet",-1)),i("p",Ve,u(s.copilotId?`Start a new conversation with ${((P=o.copilot)==null?void 0:P.name)||"this Copilot"}.`:"Start a new conversation with a Copilot via the Copilots page."),1),s.copilotId?(r(),w(f,{key:0,type:"primary",size:"md",leftIcon:o.Plus,leftIconSize:"20",action:a.startNewConversation},{default:c(()=>e[7]||(e[7]=[i("span",null,"New Conversation",-1)])),_:1},8,["leftIcon","action"])):m("",!0)])])),l(V,{ref:"updateThreadModal",onUpdated:a.onThreadUpdated},null,8,["onUpdated"]),l(j,{ref:"deleteThreadModal",onDeleted:a.onThreadDeleted},null,8,["onDeleted"]),l(q,{ref:"deleteThreadsModal",onDeleted:a.onThreadsDeleted},null,8,["onDeleted"])])}const at=k(_e,[["render",je]]);export{at as default};
