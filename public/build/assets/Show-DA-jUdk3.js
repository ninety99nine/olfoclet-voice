import{S as L,M as k,T as R,P as O,i as D,a as T}from"./Table-DlpK1Rd7.js";import{I as v,P as j}from"./Input-D9fdoO8s.js";import{B as q}from"./Button-BPBi_ARr.js";import{f as W,a as Z,D as Q}from"./dateUtils-D6l5PLPY.js";import{j as y,m as K,w as u,r as c,o as r,a as i,d as l,k as Y,c as p,b as _,e as E,t as B,F as f,h as S,n as M,i as C}from"./app-D8abw76g.js";import{_ as b}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as G}from"./circle-alert-Cc2u2IwP.js";import{L as z}from"./library-big-D7dMT2rN.js";import{P as H}from"./pencil-D70OFnnY.js";import{P as J}from"./plus-DJJoiXq5.js";import"./createLucideIcon-BATKjYGm.js";import"./Tooltip-CpwOIouF.js";import"./Drawer-Cyu-M1h4.js";import"./arrow-up-Z1aW1w9m.js";import"./Switch-CBkPdvWc.js";import"./vue-draggable-next.esm-bundler-CnBwFquK.js";import"./mail-TMfp7w7g.js";const X={components:{Modal:k,Input:v,Select:L},inject:["formState","notificationState"],data(){return{isCreating:!1,form:{name:"",organization_id:null},organizationOptions:[]}},methods:{showModal(){this.reset(),this.fetchOrganizations(),this.$refs.modal.showModal()},reset(){this.form.name="",this.form.organization_id=null},async fetchOrganizations(){var s;try{const e=await y.get("/api/organizations");this.organizationOptions=(((s=e.data)==null?void 0:s.data)??[]).map(a=>({label:a.name,value:a.id}))}catch(e){console.error("Failed to load organizations:",e)}},async createKnowledgeBase(s){var e,a;if(this.formState.hideFormErrors(),this.form.name.trim()===""&&this.formState.setFormError("name","Knowledge base name is required"),this.form.organization_id||this.formState.setFormError("organization_id","Organization is required"),!this.formState.hasErrors){this.isCreating=!0;try{const n={...this.form};await y.post("/api/knowledge-bases",n,{params:{organization_id:this.form.organization_id}}),this.notificationState.showSuccessNotification("Knowledge base created"),this.$emit("created"),s()}catch(n){const t=((a=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:a.message)||(n==null?void 0:n.message)||"Something went wrong trying to create the knowledge base";this.notificationState.showWarningNotification(t),this.formState.setServerFormErrors(n),console.error("Failed to create knowledge base:",n)}finally{this.isCreating=!1}}}}},$={class:"space-y-4"};function ee(s,e,a,n,t,o){const g=c("Input"),m=c("Select"),x=c("Modal");return r(),K(x,{size:"sm",ref:"modal",showFooter:!0,dismissable:!0,scrollOnContent:!1,showApproveButton:!0,header:"Create New Knowledge Base",approveText:"Create Knowledge Base",approveAction:o.createKnowledgeBase,approveLoading:t.isCreating,subheader:"Add a new knowledge base to the platform"},{trigger:u(w=>[Y(s.$slots,"default",{showModal:w.showModal})]),content:u(()=>[i("div",$,[l(g,{modelValue:t.form.name,"onUpdate:modelValue":e[0]||(e[0]=w=>t.form.name=w),showAsterisk:!0,label:"Knowledge Base Name",placeholder:"Enter knowledge base name",errorText:o.formState.getFormError("name")},null,8,["modelValue","errorText"]),l(m,{modelValue:t.form.organization_id,"onUpdate:modelValue":e[1]||(e[1]=w=>t.form.organization_id=w),options:t.organizationOptions,label:"Organization",placeholder:"Select organization",errorText:o.formState.getFormError("organization_id")},null,8,["modelValue","options","errorText"])])]),_:3},8,["approveAction","approveLoading"])}const te=b(X,[["render",ee]]),se={name:"UpdateKnowledgeBaseModal",inject:["formState","notificationState"],components:{Modal:k,Input:v},data(){return{isUpdating:!1,knowledgeBase:null,form:{name:""}}},methods:{showModal(s){this.reset(),this.knowledgeBase=s,this.form.name=s.name,this.$refs.modal.showModal()},reset(){this.form.name="",this.knowledgeBase=null},async updateKnowledgeBase(s){var e,a;if(this.formState.hideFormErrors(),this.form.name.trim()===""&&this.formState.setFormError("name","Knowledge base name is required"),!this.formState.hasErrors){this.isUpdating=!0;try{const n=this.knowledgeBase._links.update,t={name:this.form.name};await y.put(n,t),this.notificationState.showSuccessNotification("Knowledge base updated"),this.$emit("updated"),s()}catch(n){const t=((a=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:a.message)||(n==null?void 0:n.message)||"Something went wrong updating the knowledge base";this.notificationState.showWarningNotification(t),this.formState.setServerFormErrors(n),console.error("Failed to update knowledge base:",n)}finally{this.isUpdating=!1}}}}},oe={class:"space-y-4"};function ne(s,e,a,n,t,o){const g=c("Input"),m=c("Modal");return r(),K(m,{size:"sm",ref:"modal",showFooter:!0,dismissable:!0,scrollOnContent:!1,showApproveButton:!0,approveLoading:t.isUpdating,header:"Update Knowledge Base",approveText:"Update Knowledge Base",approveAction:o.updateKnowledgeBase,subheader:"Modify the knowledge base's details"},{content:u(()=>[i("div",oe,[l(g,{modelValue:t.form.name,"onUpdate:modelValue":e[0]||(e[0]=x=>t.form.name=x),showAsterisk:!0,label:"Knowledge Base Name",placeholder:"Enter knowledge base name",errorText:o.formState.getFormError("name")},null,8,["modelValue","errorText"])])]),_:1},8,["approveLoading","approveAction"])}const ae=b(se,[["render",ne]]),ie={components:{Modal:k},inject:["notificationState"],data(){return{knowledgeBase:null,isDeleting:!1}},methods:{showModal(s){this.knowledgeBase=s,this.$refs.modal.showModal()},async onDelete(s){var e,a,n;if(this.knowledgeBase){this.isDeleting=!0;try{const t=this.knowledgeBase._links.delete,o=await y.delete(t);(e=o==null?void 0:o.data)!=null&&e.message&&this.notificationState.showSuccessNotification(o.data.message),this.$emit("deleted",this.knowledgeBase.id),s()}catch(t){const o=((n=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:n.message)||(t==null?void 0:t.message)||"Something went wrong while deleting the knowledge base";this.notificationState.showWarningNotification(o)}finally{this.isDeleting=!1}}}}},re={key:0,class:"text-sm text-gray-700 dark:text-neutral-400"},le={class:"font-bold text-black"};function de(s,e,a,n,t,o){const g=c("Modal");return r(),K(g,{size:"sm",ref:"modal",approveType:"danger",header:"Confirm Delete",isLoading:t.isDeleting,approveAction:o.onDelete,approveText:"Delete Knowledge Base"},{content:u(()=>[t.knowledgeBase?(r(),p("p",re,[e[0]||(e[0]=E(" Are you sure you want to permanently delete ")),i("span",le,B(t.knowledgeBase.name),1),e[1]||(e[1]=E("? "))])):_("",!0)]),_:1},8,["isLoading","approveAction"])}const ce=b(ie,[["render",de]]),pe={inject:["notificationState"],components:{Modal:k,CircleAlert:G},data(){return{isDeleting:!1,knowledgeBaseIds:[]}},computed:{total(){return this.knowledgeBaseIds.length},approveText(){return this.total===1?"Delete Knowledge Base":"Delete Knowledge Bases"}},methods:{showModal(s=[]){this.knowledgeBaseIds=s,this.$refs.modal.showModal()},async onDelete(s){var e,a,n;if(!(this.isDeleting||this.knowledgeBaseIds.length===0)){this.isDeleting=!0;try{const t="/api/knowledge-bases",o={data:{knowledge_base_ids:this.knowledgeBaseIds}},g=await y.delete(t,o),m=(e=g==null?void 0:g.data)==null?void 0:e.message;m&&this.notificationState.showSuccessNotification(m),this.$emit("deleted",this.knowledgeBaseIds),s()}catch(t){const o=((n=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:n.message)||(t==null?void 0:t.message)||"Something went wrong while deleting knowledge bases";this.notificationState.showWarningNotification(o)}finally{this.isDeleting=!1}}}}},ge={class:"flex space-x-2 items-center p-4 text-xs bg-red-50 text-red-500 border border-red-200 border-dashed rounded-lg mb-8"};function me(s,e,a,n,t,o){const g=c("CircleAlert"),m=c("Modal");return r(),K(m,{size:"sm",ref:"modal",approveType:"danger",approveIcon:"delete",isLoading:t.isDeleting,approveAction:o.onDelete,approveText:o.approveText,header:"Delete Knowledge Bases"},{content:u(()=>[i("div",ge,[l(g,{size:"20"}),i("span",null," Are you sure you want to delete "+B(o.total>1?`these ${o.total} knowledge bases`:"this 1 knowledge base")+"? ",1)])]),_:1},8,["isLoading","approveAction","approveText"])}const he=b(pe,[["render",me]]),ue={inject:["formState","notificationState"],components:{Pill:O,Modal:k,Input:v,Button:q,Popover:j,Dropdown:Q,Table:R,AddKnowledgeBaseModal:te,UpdateKnowledgeBaseModal:ae,DeleteKnowledgeBaseModal:ce,DeleteKnowledgeBasesModal:he,LibraryBig:z},data(){return{Plus:J,Pencil:H,Trash2:T,LibraryBig:z,knowledgeBases:[{id:1,name:"Billing Inquiries",content_items_count:45,content_sources_count:12,created_at:"2025-04-15T08:30:00Z"},{id:2,name:"Network Troubleshooting",content_items_count:60,content_sources_count:18,created_at:"2025-03-20T14:45:00Z"},{id:3,name:"All My Friends Bundles",content_items_count:25,content_sources_count:8,created_at:"2025-05-01T10:15:00Z"},{id:4,name:"Prepaid Plan FAQs",content_items_count:35,content_sources_count:10,created_at:"2025-02-10T09:00:00Z"},{id:5,name:"Customer Support Scripts",content_items_count:50,content_sources_count:15,created_at:"2025-01-25T16:20:00Z"}],perPage:"15",checkedRows:[],pagination:{meta:{total:5,per_page:15,current_page:1,last_page:1},data:[]},searchTerm:null,selectAll:!1,filterExpressions:[],sortingExpressions:[],isLoadingKnowledgeBases:!1,columns:this.prepareColumns(),dropdownOptions:[{icon:T,label:"Delete",action:this.showDeleteKnowledgeBasesModal}]}},watch:{selectAll(s){this.checkedRows=this.knowledgeBases.reduce((e,a)=>(e[a.id]=s,e),{})}},computed:{hasSearchTerm(){return this.searchTerm!=null&&this.searchTerm.trim()!=""},totalCheckedRows(){return Object.values(this.checkedRows).filter(s=>s).length},hasFilterExpressions(){return this.filterExpressions.length>0},hasSortingExpressions(){return this.sortingExpressions.length>0},showTable(){var s;return this.isLoadingKnowledgeBases||((s=(this.pagination??{}).meta)==null?void 0:s.total)>0||this.hasSearchTerm||this.hasFilterExpressions||this.hasSortingExpressions}},methods:{formattedDatetime:Z,formattedRelativeDate:W,prepareColumns(){const s=["Name","Content Items","Sources","Created Date"],e=["Name","Content Items","Sources","Created Date"];return s.map(a=>({name:a,active:e.includes(a),priority:e.includes(a)}))},showAddKnowledgeBaseModal(){this.$refs.addKnowledgeBaseModal.showModal()},showUpdateKnowledgeBaseModal(s){this.$refs.updateKnowledgeBaseModal.showModal(s)},showDeleteKnowledgeBaseModal(s){this.$refs.deleteKnowledgeBaseModal.showModal(s)},showDeleteKnowledgeBasesModal(){const s=this.knowledgeBases.filter(e=>this.checkedRows[e.id]).map(e=>e.id);this.$refs.deleteKnowledgeBasesModal.showModal(s)},onKnowledgeBaseDeleted(s){this.knowledgeBases=this.knowledgeBases.filter(e=>e.id!==s),this.knowledgeBases.length===0&&this.fetchKnowledgeBases()},onKnowledgeBasesDeleted(s=[]){s.forEach(e=>{this.checkedRows[e]!==void 0&&(this.checkedRows[e]=!1)}),this.selectAll=!1,this.knowledgeBases=this.knowledgeBases.filter(e=>!s.includes(e.id)),this.knowledgeBases.length===0&&this.fetchKnowledgeBases()},paginate(s){this.fetchKnowledgeBases(s)},search(s){this.searchTerm=s,this.fetchKnowledgeBases()},updatedColumns(s){this.columns=s},updatedFilters(s){const e=s.map(a=>a.expression);D(this.filterExpressions,e)||(this.filterExpressions=e,this.fetchKnowledgeBases())},updatedSorting(s){const e=s.map(a=>a.expression);D(this.sortingExpressions,e)||(this.sortingExpressions=e,this.fetchKnowledgeBases())},updatedPerPage(s){this.perPage=s,this.fetchKnowledgeBases()},onView(s){this.$router.push({name:"manage-knowledge-base",params:{knowledgeBaseId:s.id}})},async fetchKnowledgeBases(s=null){var e,a;try{this.isLoadingKnowledgeBases=!0,this.pagination={meta:{total:this.knowledgeBases.length,per_page:parseInt(this.perPage),current_page:1,last_page:1},data:this.knowledgeBases},this.checkedRows=this.knowledgeBases.reduce((n,t)=>(n[t.id]=!1,n),{})}catch(n){const t=((a=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:a.message)||(n==null?void 0:n.message)||"Something went wrong while fetching knowledge bases";this.notificationState.showWarningNotification(t),console.error("Failed to fetch knowledge bases:",n)}finally{this.isLoadingKnowledgeBases=!1}}},created(){this.isLoadingKnowledgeBases=!0,this.searchTerm=this.$route.query.searchTerm,this.$route.query.filterExpressions&&(this.filterExpressions=this.$route.query.filterExpressions.split("|")),this.$route.query.sortingExpressions&&(this.sortingExpressions=this.$route.query.sortingExpressions.split("|")),this.fetchKnowledgeBases()}},we={class:"select-none min-h-screen bg-gray-50 pt-8 p-4 sm:p-8 space-y-4 sm:space-y-6"},fe={class:"flex justify-between"},_e={class:"flex items-end space-x-2"},Be={class:"flex justify-end"},xe={class:"border-b border-indigo-200"},ye={scope:"col",class:"whitespace-nowrap align-top font-semibold px-4 py-2.5"},ke=["onClick"],be={key:0,class:"whitespace-nowrap align-center pr-4 py-4"},Ke={key:1,class:"whitespace-nowrap align-center text-center pr-4 py-4"},Se={key:2,class:"whitespace-nowrap align-center text-center pr-4 py-4"},Me={key:3,class:"whitespace-nowrap align-center pr-4 py-4"},ve={class:"flex space-x-1 items-center"},De={class:"h-16 pr-4 py-4 flex align-middle items-center space-x-2"},Te={key:1,class:"select-none w-full flex justify-center py-16"},Ee={class:"max-w-sm w-full bg-white shadow-sm rounded-xl p-6 flex flex-col items-center text-center space-y-4 border border-dashed border-gray-200"};function Ce(s,e,a,n,t,o){const g=c("LibraryBig"),m=c("Button"),x=c("Dropdown"),w=c("Input"),A=c("Popover"),I=c("Table"),P=c("AddKnowledgeBaseModal"),U=c("UpdateKnowledgeBaseModal"),F=c("DeleteKnowledgeBaseModal"),N=c("DeleteKnowledgeBasesModal");return r(),p("div",we,[o.showTable?(r(),p(f,{key:0},[i("div",fe,[i("div",_e,[l(g,{size:"48","stroke-width":"1",class:"text-gray-400"}),e[2]||(e[2]=i("div",null,[i("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white"},"Knowledge"),i("p",{class:"text-sm text-gray-600 dark:text-neutral-400"}," Manage knowledge bases for your organization ")],-1))]),i("div",Be,[l(m,{type:"primary",size:"md",leftIcon:t.Plus,leftIconSize:"20",action:o.showAddKnowledgeBaseModal},{default:u(()=>e[3]||(e[3]=[i("span",null,"Add Knowledge Base",-1)])),_:1},8,["leftIcon","action"])])]),l(I,{onSearch:o.search,resource:"knowledge-bases",columns:t.columns,perPage:t.perPage,onPaginate:o.paginate,onRefresh:o.fetchKnowledgeBases,searchTerm:t.searchTerm,pagination:t.pagination,isLoading:t.isLoadingKnowledgeBases,onUpdatedColumns:o.updatedColumns,onUpdatedFilters:o.updatedFilters,onUpdatedSorting:o.updatedSorting,onUpdatedPerPage:o.updatedPerPage,filterExpressions:t.filterExpressions,sortingExpressions:t.sortingExpressions},{belowToolbar:u(()=>[i("div",{class:M([{hidden:o.totalCheckedRows===0},"bg-gray-50 border flex items-center mb-2 p-4 rounded-lg shadow space-x-2"])},[e[4]||(e[4]=i("span",{class:"text-sm"},"Actions: ",-1)),l(x,{triggerSize:"sm",options:t.dropdownOptions,triggerText:`Select Action (${o.totalCheckedRows} selected)`},null,8,["options","triggerText"])],2)]),head:u(()=>[i("tr",xe,[i("th",ye,[l(w,{type:"checkbox",modelValue:t.selectAll,"onUpdate:modelValue":e[0]||(e[0]=d=>t.selectAll=d)},null,8,["modelValue"])]),(r(!0),p(f,null,S(t.columns,(d,h)=>(r(),p(f,{key:h},[d.active?(r(),p("th",{key:0,scope:"col",class:M(["whitespace-nowrap align-top font-semibold pr-4 py-2.5",{"text-center":["Content Items","Sources"].includes(d.name)}])},B(d.name),3)):_("",!0)],64))),128)),e[5]||(e[5]=i("th",{scope:"col",class:"whitespace-nowrap align-top font-semibold pr-4 py-2.5"},"Actions",-1))])]),body:u(()=>[(r(!0),p(f,null,S(t.knowledgeBases,d=>(r(),p("tr",{key:d.id,onClick:C(h=>o.onView(d),["stop"]),class:M([t.checkedRows[d.id]?"bg-blue-50":"bg-white hover:bg-gray-50","group cursor-pointer text-sm border-b border-gray-200"])},[i("td",{onClick:e[1]||(e[1]=C(()=>{},["stop"])),class:"whitespace-nowrap align-top px-4 py-4"},[l(w,{type:"checkbox",modelValue:t.checkedRows[d.id],"onUpdate:modelValue":h=>t.checkedRows[d.id]=h},null,8,["modelValue","onUpdate:modelValue"])]),(r(!0),p(f,null,S(t.columns,(h,V)=>(r(),p(f,{key:V},[h.active?(r(),p(f,{key:0},[h.name=="Name"?(r(),p("td",be,[i("div",null,B(d.name),1)])):_("",!0),h.name=="Content Items"?(r(),p("td",Ke,[i("span",null,B(d.content_items_count),1)])):_("",!0),h.name=="Sources"?(r(),p("td",Se,[i("span",null,B(d.content_sources_count),1)])):_("",!0),h.name=="Created Date"?(r(),p("td",Me,[i("div",ve,[i("span",null,B(o.formattedDatetime(d.created_at)),1),l(A,{placement:"top",class:"opacity-0 group-hover:opacity-100",content:o.formattedRelativeDate(d.created_at)},null,8,["content"])])])):_("",!0)],64)):_("",!0)],64))),128)),i("td",De,[l(m,{type:"bare",size:"xs",leftIcon:t.Pencil,leftIconSize:"16",action:()=>o.showUpdateKnowledgeBaseModal(d)},null,8,["leftIcon","action"]),l(m,{type:"bareDanger",size:"xs",leftIcon:t.Trash2,leftIconSize:"16",action:()=>o.showDeleteKnowledgeBaseModal(d)},null,8,["leftIcon","action"])])],10,ke))),128))]),_:1},8,["onSearch","columns","perPage","onPaginate","onRefresh","searchTerm","pagination","isLoading","onUpdatedColumns","onUpdatedFilters","onUpdatedSorting","onUpdatedPerPage","filterExpressions","sortingExpressions"])],64)):(r(),p("div",Te,[i("div",Ee,[l(g,{size:"48",class:"text-gray-400"}),e[7]||(e[7]=i("h2",{class:"text-2xl font-bold text-gray-800"},"No Knowledge Bases Yet",-1)),e[8]||(e[8]=i("p",{class:"text-sm text-gray-500"},"Add a knowledge base to manage content and sources.",-1)),l(m,{type:"primary",size:"md",leftIcon:t.Plus,leftIconSize:"20",action:o.showAddKnowledgeBaseModal},{default:u(()=>e[6]||(e[6]=[i("span",null,"Add Knowledge Base",-1)])),_:1},8,["leftIcon","action"])])])),l(P,{ref:"addKnowledgeBaseModal",onCreated:o.fetchKnowledgeBases},null,8,["onCreated"]),l(U,{ref:"updateKnowledgeBaseModal",onUpdated:o.fetchKnowledgeBases},null,8,["onUpdated"]),l(F,{ref:"deleteKnowledgeBaseModal",onDeleted:o.onKnowledgeBaseDeleted},null,8,["onDeleted"]),l(N,{ref:"deleteKnowledgeBasesModal",onDeleted:o.onKnowledgeBasesDeleted},null,8,["onDeleted"])])}const Ge=b(ue,[["render",Ce]]);export{Ge as default};
