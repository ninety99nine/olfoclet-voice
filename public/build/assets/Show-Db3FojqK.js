import{i as y,m as F,w as m,r as p,o as a,a as o,d as c,c as n,b as f,t as g,F as w,G as L,l as A,n as S,h as $}from"./app-Bh0CRPT1.js";import{S as B,M as x,T as V,i as k,a as D}from"./Table-C-dAgqL-.js";import{I as z,P as W}from"./Input-DLLHQFCa.js";import{B as j}from"./Button-D-J7vJoA.js";import{f as q,a as H,D as Y}from"./dateUtils-BHWJh6Nr.js";import{_ as b}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C}from"./circle-play-DpnAJoSH.js";import{P as G}from"./play-j9duPwY9.js";import{P as K}from"./pencil-DHfiUf6s.js";import{P as J}from"./plus-YFJMpCfm.js";import"./createLucideIcon-C9p8Jo51.js";import"./Tooltip-CP6j0BUe.js";import"./Drawer-Bx9DDrOI.js";import"./arrow-up-Q9vzLiuS.js";import"./Switch-kMwrpPJn.js";import"./vue-draggable-next.esm-bundler-C0JoXrCN.js";import"./mail-D1Pe_K0u.js";const Q={components:{Modal:x,Input:z,Select:B},data(){return{form:{organization_id:null,name:"",file:null},errors:{},organizationOptions:[]}},mounted(){this.fetchOrganizations()},methods:{async fetchOrganizations(){var e;try{const t=await y.get("/api/organizations");this.organizationOptions=(((e=t.data)==null?void 0:e.data)??[]).map(l=>({label:l.name,value:l.id}))}catch(t){console.error("Failed to load organizations:",t),this.$notificationState.showWarningNotification("Failed to load organizations.")}},showModal(){this.form={organization_id:null,name:"",file:null},this.errors={},this.$refs.modal.showModal()},onFileChange(e){this.form.file=e.target.files[0],!this.form.name&&this.form.file&&(this.form.name=this.form.file.name.split(".").slice(0,-1).join("."))},async uploadFile(e){var l,r;if(this.errors={},this.form.organization_id||(this.errors.organization_id="Organization is required."),this.form.file||(this.errors.file="Please select a file to upload."),Object.keys(this.errors).length>0)return;const t=new FormData;t.append("name",this.form.name),t.append("file",this.form.file),t.append("organization_id",this.form.organization_id);try{await y.post("/api/media-files",t,{headers:{"Content-Type":"multipart/form-data"}}),this.$notificationState.showSuccessNotification("Media file uploaded successfully!"),this.$emit("file-uploaded"),e()}catch(i){console.error("Failed to upload media file:",i),(r=(l=i.response)==null?void 0:l.data)!=null&&r.errors?this.errors=i.response.data.errors:this.$notificationState.showWarningNotification("Failed to upload media file.")}}}},X={class:"space-y-4 p-4"},Z={key:0,class:"text-red-600 text-sm mt-1"};function ee(e,t,l,r,i,s){const h=p("Select"),_=p("Input"),v=p("Modal");return a(),F(v,{ref:"modal",showFooter:!0,dismissable:!0,scrollOnContent:!1,showApproveButton:!0,header:"Upload Media File",approveText:"Upload",approveAction:s.uploadFile},{content:m(()=>[o("div",X,[c(h,{modelValue:i.form.organization_id,"onUpdate:modelValue":t[0]||(t[0]=M=>i.form.organization_id=M),options:i.organizationOptions,showAsterisk:!0,label:"Organization",placeholder:"Select organization",error:i.errors.organization_id},null,8,["modelValue","options","error"]),c(_,{modelValue:i.form.name,"onUpdate:modelValue":t[1]||(t[1]=M=>i.form.name=M),label:"File Name",placeholder:"Enter a name for the file",error:i.errors.name},null,8,["modelValue","error"]),o("div",null,[t[3]||(t[3]=o("label",{class:"block text-sm font-medium text-gray-700"},"File",-1)),o("input",{type:"file",onChange:t[2]||(t[2]=(...M)=>s.onFileChange&&s.onFileChange(...M)),class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),i.errors.file?(a(),n("p",Z,g(i.errors.file),1)):f("",!0)])])]),_:1},8,["approveAction"])}const te=b(Q,[["render",ee]]),ie={components:{Modal:x},props:{mediaFileId:{type:[String,null],required:!0}},data(){return{audioUrl:null}},watch:{mediaFileId(e){e&&this.fetchAudioUrl()}},beforeUnmount(){this.stopAndCleanup()},methods:{async fetchAudioUrl(){if(!this.mediaFileId){console.error("Media file ID is null or undefined"),this.$notificationState.showWarningNotification("Cannot load audio: Invalid media file ID."),this.$refs.modal.hideModal();return}try{const e=await y.get(`/api/media-files/${this.mediaFileId}/presigned-url`);this.audioUrl=e.data.url}catch(e){console.error("Failed to fetch pre-signed URL for audio:",e),this.$notificationState.showWarningNotification("Failed to load audio file."),this.$refs.modal.hideModal()}},showModal(){this.audioUrl=null,this.$refs.modal.showModal()},stopAndCleanup(){const e=this.$refs.audioPlayer;e&&(e.pause(),e.currentTime=0),this.audioUrl=null},stopAndCloseModal(){this.stopAndCleanup(),this.$refs.modal.hideModal()}}},se={key:0,class:"p-4"},oe=["src"],ae={key:1,class:"p-4 text-center text-gray-500"};function le(e,t,l,r,i,s){const h=p("Modal");return a(),F(h,{ref:"modal",showFooter:!0,dismissable:!0,header:"Play Audio",approveText:"Close",scrollOnContent:!1,onOnHide:s.stopAndCleanup,showApproveButton:!0,approveAction:s.stopAndCloseModal},{content:m(()=>[i.audioUrl?(a(),n("div",se,[o("audio",{ref:"audioPlayer",controls:"",src:i.audioUrl,class:"w-full"}," Your browser does not support the audio element. ",8,oe)])):(a(),n("div",ae," Loading audio... "))]),_:1},8,["onOnHide","approveAction"])}const ne=b(ie,[["render",le]]),re={components:{Modal:x},props:{mediaFileId:{type:[String,null],required:!0}},data(){return{audioUrl:null}},beforeUnmount(){this.stopAndCleanup()},methods:{async fetchAudioUrl(){try{const e=await y.get(`/api/media-files/${this.mediaFileId}/presigned-url`);this.audioUrl=e.data.url}catch(e){console.error("Failed to fetch pre-signed URL for audio:",e),this.$notificationState.showWarningNotification("Failed to load audio file."),this.$refs.modal.hideModal()}},showModal(){this.audioUrl=null,this.fetchAudioUrl(),this.$refs.modal.showModal()},stopAndCleanup(){const e=this.$refs.audioPlayer;e&&(e.pause(),e.currentTime=0),this.audioUrl=null},stopAndCloseModal(){this.stopAndCleanup(),this.$refs.modal.hideModal()}}},de={key:0,class:"p-4"},ce=["src"],pe={key:1,class:"p-4 text-center text-gray-500"};function he(e,t,l,r,i,s){const h=p("Modal");return a(),F(h,{ref:"modal",showFooter:!0,dismissable:!0,scrollOnContent:!1,header:"Play Audio",approveText:"Close",showApproveButton:!0,approveAction:s.stopAndCloseModal,onModalHidden:s.stopAndCloseModal},{content:m(()=>[i.audioUrl?(a(),n("div",de,[o("audio",{ref:"audioPlayer",controls:"",src:i.audioUrl,class:"w-full"}," Your browser does not support the audio element. ",8,ce)])):(a(),n("div",pe," Loading audio... "))]),_:1},8,["approveAction","onModalHidden"])}const ue=b(re,[["render",he]]),fe={components:{Modal:x},data(){return{isDeleting:!1,mediaFile:null}},methods:{showModal(e){this.mediaFile=e,this.$refs.modal.showModal()},async deleteMediaFile(e){this.isDeleting=!0;try{await y.delete(`/api/media-files/${this.mediaFile.id}`),this.$notificationState.showSuccessNotification("Media file deleted successfully!"),this.$emit("deleted",this.mediaFile.id),e()}catch(t){console.error("Failed to delete media file:",t),this.$notificationState.showWarningNotification("Failed to delete media file.")}finally{this.isDeleting=!1}}}};function me(e,t,l,r,i,s){const h=p("Modal");return a(),F(h,{size:"sm",ref:"modal",showFooter:!0,dismissable:!0,scrollOnContent:!1,showApproveButton:!0,header:"Delete Media File",approveText:"Delete",approveLoading:i.isDeleting,approveAction:s.deleteMediaFile,subheader:"Are you sure you want to delete this media file?"},{content:m(()=>t[0]||(t[0]=[o("div",{class:"p-4"},[o("p",{class:"text-sm text-gray-700 dark:text-neutral-400"}," This action cannot be undone. The media file will be permanently deleted. ")],-1)])),_:1},8,["approveLoading","approveAction"])}const ge=b(fe,[["render",me]]),Me={components:{Modal:x},data(){return{isDeleting:!1,mediaFileIds:[]}},methods:{showModal(e){this.mediaFileIds=e,this.$refs.modal.showModal()},async deleteMediaFiles(e){this.isDeleting=!0;try{await y.delete("/api/media-files",{params:{media_file_ids:this.mediaFileIds}}),this.$notificationState.showSuccessNotification(`${this.mediaFileIds.length} media file(s) deleted successfully!`),this.$emit("deleted",this.mediaFileIds),e()}catch(t){console.error("Failed to delete media files:",t),this.$notificationState.showWarningNotification("Failed to delete media files.")}finally{this.isDeleting=!1}}}},_e={class:"p-4"},we={class:"text-sm text-gray-700 dark:text-neutral-400"};function ye(e,t,l,r,i,s){const h=p("Modal");return a(),F(h,{size:"sm",ref:"modal",showFooter:!0,dismissable:!0,scrollOnContent:!1,showApproveButton:!0,header:"Delete Media Files",approveText:"Delete",approveLoading:i.isDeleting,approveAction:s.deleteMediaFiles,subheader:"Are you sure you want to delete the selected media files?"},{content:m(()=>[o("div",_e,[o("p",we," This action cannot be undone. "+g(i.mediaFileIds.length)+" media file(s) will be permanently deleted. ",1)])]),_:1},8,["approveLoading","approveAction"])}const Fe=b(Me,[["render",ye]]),xe={inject:["formState","notificationState"],components:{Modal:x,Input:z,Table:V,Button:j,Popover:W,Dropdown:Y,CirclePlay:C,AddMediaFileModal:te,PlayMediaFileModal:ne,UpdateMediaFileModal:ue,DeleteMediaFileModal:ge,DeleteMediaFilesModal:Fe},data(){return{Plus:J,Pencil:K,Trash2:D,Play:G,CirclePlay:C,perPage:"15",mediaFiles:[],getCountryName:L,checkedRows:[],pagination:null,searchTerm:null,selectAll:!1,filterExpressions:[],sortingExpressions:[],selectedMediaFile:null,selectedMediaFileId:null,isLoadingMediaFiles:!1,columns:this.prepareColumns(),dropdownOptions:[{icon:D,label:"Delete",action:this.showDeleteMediaFilesModal}]}},watch:{selectAll(e){this.checkedRows=this.mediaFiles.reduce((t,l)=>(t[l.id]=e,t),{})}},computed:{hasSearchTerm(){return this.searchTerm!=null&&this.searchTerm.trim()!==""},totalCheckedRows(){return Object.values(this.checkedRows).filter(Boolean).length},hasFilterExpressions(){return this.filterExpressions.length>0},hasSortingExpressions(){return this.sortingExpressions.length>0},showTable(){var e;return this.isLoadingMediaFiles||((e=(this.pagination??{}).meta)==null?void 0:e.total)>0||this.hasSearchTerm||this.hasFilterExpressions||this.hasSortingExpressions}},methods:{formattedDatetime:H,formattedRelativeDate:q,prepareColumns(){const e=["Name","File Name","Type","Size","Organization","Created Date"],t=["Name","File Name","Type","Size","Organization","Created Date"];return e.map(l=>({name:l,active:t.includes(l),priority:t.includes(l)}))},showUploadModal(){this.$refs.uploadModal.showModal()},showEditModal(e){this.selectedMediaFile=e,this.$refs.editModal.showModal()},showDeleteMediaFileModal(e){this.$refs.deleteMediaFileModal.showModal(e)},showDeleteMediaFilesModal(){const e=this.mediaFiles.filter(t=>this.checkedRows[t.id]).map(t=>t.id);this.$refs.deleteMediaFilesModal.showModal(e)},onMediaFileDeleted(e){this.mediaFiles=this.mediaFiles.filter(t=>t.id!==e),this.mediaFiles.length===0&&this.fetchMediaFiles()},onMediaFilesDeleted(e=[]){e.forEach(t=>{this.checkedRows[t]!==void 0&&(this.checkedRows[t]=!1)}),this.selectAll=!1,this.mediaFiles=this.mediaFiles.filter(t=>!e.includes(t.id)),this.mediaFiles.length===0&&this.fetchMediaFiles()},paginate(e){this.fetchMediaFiles(e)},search(e){this.searchTerm=e,this.fetchMediaFiles()},updatedColumns(e){this.columns=e},updatedFilters(e){const t=e.map(l=>l.expression);k(this.filterExpressions,t)||(this.filterExpressions=t,this.fetchMediaFiles())},updatedSorting(e){const t=e.map(l=>l.expression);k(this.sortingExpressions,t)||(this.sortingExpressions=t,this.fetchMediaFiles())},updatedPerPage(e){this.perPage=e,this.fetchMediaFiles()},async fetchMediaFiles(e=null){var t,l;try{this.isLoadingMediaFiles=!0,e=e??"/api/media-files";let r={params:{per_page:this.perPage,_relationships:"organization,callFlowNodes"}};this.hasSearchTerm&&(r.params.search=this.searchTerm),this.hasFilterExpressions&&(r.params._filters=this.filterExpressions.join("|")),this.hasSortingExpressions&&(r.params._sort=this.sortingExpressions.join("|"));const i=await y.get(e,r);this.pagination=i.data,this.mediaFiles=this.pagination.data,this.checkedRows=this.mediaFiles.reduce((s,h)=>(s[h.id]=!1,s),{})}catch(r){const i=((l=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:l.message)||(r==null?void 0:r.message)||"Something went wrong while fetching media files";this.notificationState.showWarningNotification(i),console.error("Failed to fetch media files:",r)}finally{this.isLoadingMediaFiles=!1}},formatSize(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:`${(e/(1024*1024)).toFixed(2)} MB`},isAudioFile(e){return e.startsWith("audio/")},playAudio(e){if(!e){console.error("Media file ID is null or undefined"),this.$notificationState.showWarningNotification("Cannot play audio: Invalid media file ID.");return}this.selectedMediaFileId=e,this.$nextTick(()=>{this.$refs.audioModal.showModal()})}},created(){this.isLoadingMediaFiles=!0,this.searchTerm=this.$route.query.searchTerm,this.$route.query.filterExpressions&&(this.filterExpressions=this.$route.query.filterExpressions.split("|")),this.$route.query.sortingExpressions&&(this.sortingExpressions=this.$route.query.sortingExpressions.split("|")),this.fetchMediaFiles()}},be={class:"select-none min-h-screen bg-gray-50 pt-8 p-4 sm:p-8 space-y-4 sm:space-y-6"},ve={class:"flex justify-between"},Ae={class:"flex items-end space-x-2"},Se={class:"flex justify-end space-x-2"},ke={class:"border-b border-indigo-200"},De={scope:"col",class:"whitespace-nowrap align-top font-semibold px-4 py-2.5"},Ce={key:0,scope:"col",class:"whitespace-nowrap align-top font-semibold pr-4 py-2.5"},ze={key:0,class:"whitespace-nowrap align-center pr-4 py-4 max-w-60"},Pe={class:"font-medium truncate"},Ue={key:1,class:"whitespace-nowrap align-center pr-4 py-4 max-w-60"},Ie={class:"truncate"},Te={key:2,class:"whitespace-nowrap align-center pr-4 py-4 max-w-60"},Ee={class:"truncate"},Ne={key:3,class:"whitespace-nowrap align-center pr-4 py-4"},Oe={key:4,class:"whitespace-nowrap align-center pr-4 py-4 max-w-60"},Re={key:0,class:"flex items-center space-x-2"},Le={class:"whitespace-nowrap truncate"},$e={key:5,class:"whitespace-nowrap align-center pr-4 py-4"},Be={class:"flex space-x-1 items-center"},Ve={class:"h-16 pr-4 py-4 flex align-middle items-center space-x-2"},We={key:1,class:"select-none w-full flex justify-center py-16"},je={class:"max-w-sm w-full bg-white shadow-sm rounded-xl p-6 flex flex-col items-center text-center space-y-4 border border-dashed border-gray-200"};function qe(e,t,l,r,i,s){const h=p("CirclePlay"),_=p("Button"),v=p("Dropdown"),M=p("Input"),P=p("Popover"),U=p("Table"),I=p("AddMediaFileModal"),T=p("PlayMediaFileModal"),E=p("DeleteMediaFileModal"),N=p("DeleteMediaFilesModal"),O=p("UpdateMediaFileModal");return a(),n("div",be,[s.showTable?(a(),n(w,{key:0},[o("div",ve,[o("div",Ae,[c(h,{size:"48","stroke-width":"1",class:"text-gray-400"}),t[2]||(t[2]=o("div",null,[o("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white"},"Media Files"),o("p",{class:"text-sm text-gray-600 dark:text-neutral-400"}," Manage media files within your organization ")],-1))]),o("div",Se,[c(_,{type:"primary",size:"md",leftIcon:i.Plus,leftIconSize:"20",action:s.showUploadModal},{default:m(()=>t[3]||(t[3]=[o("span",null,"Add Media File",-1)])),_:1},8,["leftIcon","action"])])]),c(U,{onSearch:s.search,columns:i.columns,perPage:i.perPage,onPaginate:s.paginate,resource:"media-files",onRefresh:s.fetchMediaFiles,searchTerm:i.searchTerm,pagination:i.pagination,onUpdatedColumns:s.updatedColumns,onUpdatedFilters:s.updatedFilters,onUpdatedSorting:s.updatedSorting,onUpdatedPerPage:s.updatedPerPage,isLoading:i.isLoadingMediaFiles,filterExpressions:i.filterExpressions,sortingExpressions:i.sortingExpressions},{belowToolbar:m(()=>[o("div",{class:S([{hidden:s.totalCheckedRows===0},"bg-gray-50 border flex items-center mb-2 p-4 rounded-lg shadow space-x-2"])},[t[4]||(t[4]=o("span",{class:"text-sm"},"Actions: ",-1)),c(v,{triggerSize:"sm",options:i.dropdownOptions,triggerText:`Select Action (${s.totalCheckedRows} selected)`},null,8,["options","triggerText"])],2)]),head:m(()=>[o("tr",ke,[o("th",De,[c(M,{type:"checkbox",modelValue:i.selectAll,"onUpdate:modelValue":t[0]||(t[0]=d=>i.selectAll=d)},null,8,["modelValue"])]),(a(!0),n(w,null,A(i.columns,(d,u)=>(a(),n(w,{key:u},[d.active?(a(),n("th",Ce,g(d.name),1)):f("",!0)],64))),128)),t[5]||(t[5]=o("th",{scope:"col",class:"whitespace-nowrap align-top font-semibold pr-4 py-2.5"},"Actions",-1))])]),body:m(()=>[(a(!0),n(w,null,A(i.mediaFiles,d=>(a(),n("tr",{key:d.id,class:S([i.checkedRows[d.id]?"bg-blue-50":"bg-white hover:bg-gray-50","group cursor-pointer text-sm border-b border-gray-200"])},[o("td",{onClick:t[1]||(t[1]=$(()=>{},["stop"])),class:"whitespace-nowrap align-top px-4 py-4"},[c(M,{type:"checkbox",modelValue:i.checkedRows[d.id],"onUpdate:modelValue":u=>i.checkedRows[d.id]=u},null,8,["modelValue","onUpdate:modelValue"])]),(a(!0),n(w,null,A(i.columns,(u,R)=>(a(),n(w,{key:R},[u.active?(a(),n(w,{key:0},[u.name==="Name"?(a(),n("td",ze,[o("div",Pe,g(d.name),1)])):f("",!0),u.name==="File Name"?(a(),n("td",Ue,[o("div",Ie,g(d.file_name),1)])):f("",!0),u.name==="Type"?(a(),n("td",Te,[o("span",Ee,g(d.mime_type),1)])):f("",!0),u.name==="Size"?(a(),n("td",Ne,[o("span",null,g(s.formatSize(d.size)),1)])):f("",!0),u.name==="Organization"?(a(),n("td",Oe,[d.organization?(a(),n("div",Re,[t[6]||(t[6]=o("img",{src:"https://placehold.co/21x24",class:"size-8 rounded-lg shrink-0",alt:"Logo"},null,-1)),o("div",Le,g(d.organization.name),1)])):f("",!0)])):f("",!0),u.name==="Created Date"?(a(),n("td",$e,[o("div",Be,[o("span",null,g(s.formattedDatetime(d.created_at)),1),c(P,{placement:"top",class:"opacity-0 group-hover:opacity-100",content:s.formattedRelativeDate(d.created_at)},null,8,["content"])])])):f("",!0)],64)):f("",!0)],64))),128)),o("td",Ve,[s.isAudioFile(d.mime_type)?(a(),F(_,{key:0,type:"bare",size:"xs",leftIcon:i.Play,leftIconSize:"16",action:()=>s.playAudio(d.id)},null,8,["leftIcon","action"])):f("",!0),c(_,{type:"bare",size:"xs",leftIcon:i.Pencil,leftIconSize:"16",action:()=>s.showEditModal(d)},null,8,["leftIcon","action"]),c(_,{type:"bareDanger",size:"xs",leftIcon:i.Trash2,leftIconSize:"16",action:()=>s.showDeleteMediaFileModal(d)},null,8,["leftIcon","action"])])],2))),128))]),_:1},8,["onSearch","columns","perPage","onPaginate","onRefresh","searchTerm","pagination","onUpdatedColumns","onUpdatedFilters","onUpdatedSorting","onUpdatedPerPage","isLoading","filterExpressions","sortingExpressions"])],64)):(a(),n("div",We,[o("div",je,[c(h,{size:"48",class:"text-gray-400"}),t[8]||(t[8]=o("h2",{class:"text-2xl font-bold text-gray-800"},"No Media Files Yet",-1)),t[9]||(t[9]=o("p",{class:"text-sm text-gray-500"},"Add a media file to manage audio and other resources.",-1)),c(_,{type:"primary",size:"md",leftIcon:i.Plus,leftIconSize:"20",action:s.showUploadModal},{default:m(()=>t[7]||(t[7]=[o("span",null,"Add Media File",-1)])),_:1},8,["leftIcon","action"])])])),c(I,{ref:"uploadModal",onFileUploaded:s.fetchMediaFiles},null,8,["onFileUploaded"]),c(T,{ref:"audioModal","media-file-id":i.selectedMediaFileId},null,8,["media-file-id"]),c(E,{ref:"deleteMediaFileModal",onDeleted:s.onMediaFileDeleted},null,8,["onDeleted"]),c(N,{ref:"deleteMediaFilesModal",onDeleted:s.onMediaFilesDeleted},null,8,["onDeleted"]),c(O,{ref:"editModal","media-file":i.selectedMediaFile,onFileUpdated:s.fetchMediaFiles},null,8,["media-file","onFileUpdated"])])}const dt=b(xe,[["render",qe]]);export{dt as default};
