import{i as x,m as v,w as f,r as c,o as l,a as r,d as p,j as O,c as d,b as u,e as b,t as D,F as _,G as j,l as z,n as k,h as C}from"./app-Bh0CRPT1.js";import{S as q,M as y,T as B,P as W,i as E,a as T}from"./Table-C-dAgqL-.js";import{I,P as Q}from"./Input-DLLHQFCa.js";import{B as G}from"./Button-D-J7vJoA.js";import{f as Y,a as H,D as J}from"./dateUtils-BHWJh6Nr.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as K}from"./circle-alert-BnPEXNJk.js";import{U as A}from"./users-round-DFWiz18L.js";import{P as X}from"./pencil-DHfiUf6s.js";import{P as Z}from"./plus-YFJMpCfm.js";import"./createLucideIcon-C9p8Jo51.js";import"./Tooltip-CP6j0BUe.js";import"./Drawer-Bx9DDrOI.js";import"./arrow-up-Q9vzLiuS.js";import"./Switch-kMwrpPJn.js";import"./vue-draggable-next.esm-bundler-C0JoXrCN.js";import"./mail-D1Pe_K0u.js";const $={components:{Modal:y,Input:I,Select:q},inject:["formState","notificationState"],data(){return{isCreating:!1,form:{name:"",organization_id:null},organizationOptions:[]}},methods:{showModal(){this.reset(),this.fetchOrganizations(),this.$refs.modal.showModal()},reset(){this.form.name="",this.form.organization_id=null},async fetchOrganizations(){var s;try{const e=await x.get("/api/organizations");this.organizationOptions=(((s=e.data)==null?void 0:s.data)??[]).map(a=>({label:a.name,value:a.id}))}catch(e){console.error("Failed to load organizations:",e)}},async createDepartment(s){var e,a;if(this.formState.hideFormErrors(),this.form.name.trim()===""&&this.formState.setFormError("name","Department name is required"),this.form.organization_id||this.formState.setFormError("organization_id","Organization is required"),!this.formState.hasErrors){this.isCreating=!0;try{const o={...this.form};await x.post("/api/departments",o,{params:{organization_id:this.form.organization_id}}),this.notificationState.showSuccessNotification("Department created"),this.$emit("created"),s()}catch(o){const t=((a=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:a.message)||(o==null?void 0:o.message)||"Something went wrong trying to create the department";this.notificationState.showWarningNotification(t),this.formState.setServerFormErrors(o),console.error("Failed to create department:",o)}finally{this.isCreating=!1}}}}},ee={class:"space-y-4"};function te(s,e,a,o,t,n){const m=c("Input"),h=c("Select"),M=c("Modal");return l(),v(M,{size:"sm",ref:"modal",showFooter:!0,dismissable:!0,scrollOnContent:!1,showApproveButton:!0,header:"Create New Department",approveText:"Create Department",approveAction:n.createDepartment,approveLoading:t.isCreating,subheader:"Add a new department to the platform"},{trigger:f(w=>[O(s.$slots,"default",{showModal:w.showModal})]),content:f(()=>[r("div",ee,[p(m,{modelValue:t.form.name,"onUpdate:modelValue":e[0]||(e[0]=w=>t.form.name=w),showAsterisk:!0,label:"Department Name",placeholder:"Enter department name",errorText:n.formState.getFormError("name")},null,8,["modelValue","errorText"]),p(h,{modelValue:t.form.organization_id,"onUpdate:modelValue":e[1]||(e[1]=w=>t.form.organization_id=w),options:t.organizationOptions,label:"Organization",placeholder:"Select organization",errorText:n.formState.getFormError("organization_id")},null,8,["modelValue","options","errorText"])])]),_:3},8,["approveAction","approveLoading"])}const se=S($,[["render",te]]),ne={components:{Modal:y},inject:["notificationState"],data(){return{department:null,isDeleting:!1}},methods:{showModal(s){this.department=s,this.$refs.modal.showModal()},async onDelete(s){var e,a,o;if(this.department){this.isDeleting=!0;try{const t=this.department._links.delete,n=await x.delete(t);(e=n==null?void 0:n.data)!=null&&e.message&&this.notificationState.showSuccessNotification(n.data.message),this.$emit("deleted",this.department.id),s()}catch(t){const n=((o=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:o.message)||(t==null?void 0:t.message)||"Something went wrong while deleting the department";this.notificationState.showWarningNotification(n)}finally{this.isDeleting=!1}}}}},oe={key:0,class:"text-sm text-gray-700 dark:text-neutral-400"},ae={class:"font-bold text-black"};function re(s,e,a,o,t,n){const m=c("Modal");return l(),v(m,{size:"sm",ref:"modal",approveType:"danger",header:"Confirm Delete",isLoading:t.isDeleting,approveAction:n.onDelete,approveText:"Delete Department"},{content:f(()=>[t.department?(l(),d("p",oe,[e[0]||(e[0]=b(" Are you sure you want to permanently delete ")),r("span",ae,D(t.department.name),1),e[1]||(e[1]=b("? "))])):u("",!0)]),_:1},8,["isLoading","approveAction"])}const ie=S(ne,[["render",re]]),le={components:{Modal:y},inject:["notificationState"],data(){return{user:null,isDeleting:!1}},methods:{showModal(s){this.user=s,this.$refs.modal.showModal()},async onDelete(s){var e,a,o;if(this.user){this.isDeleting=!0;try{const t=this.user._links.delete_user,n=await x.delete(t);(e=n==null?void 0:n.data)!=null&&e.message&&this.notificationState.showSuccessNotification(n.data.message),this.$emit("deleted",this.user.id),s()}catch(t){const n=((o=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:o.message)||(t==null?void 0:t.message)||"Something went wrong while deleting the user";this.notificationState.showWarningNotification(n)}finally{this.isDeleting=!1}}}}},de={key:0,class:"text-sm text-gray-700 dark:text-neutral-400"},pe={class:"font-bold text-black"};function ce(s,e,a,o,t,n){const m=c("Modal");return l(),v(m,{size:"sm",ref:"modal",approveType:"danger",header:"Confirm Delete",isLoading:t.isDeleting,approveAction:n.onDelete,approveText:"Delete User"},{content:f(()=>[t.user?(l(),d("p",de,[e[0]||(e[0]=b(" Are you sure you want to permanently delete ")),r("span",pe,D(t.user.name),1),e[1]||(e[1]=b("? "))])):u("",!0)]),_:1},8,["isLoading","approveAction"])}const me=S(le,[["render",ce]]),he={inject:["notificationState"],components:{Modal:y,CircleAlert:K},data(){return{isDeleting:!1,departmentIds:[]}},computed:{total(){return this.departmentIds.length},approveText(){return this.total===1?"Delete Department":"Delete Departments"}},methods:{showModal(s=[]){this.departmentIds=s,this.$refs.modal.showModal()},async onDelete(s){var e,a,o;if(!(this.isDeleting||this.departmentIds.length===0)){this.isDeleting=!0;try{const t="/api/departments",n={data:{department_ids:this.departmentIds}},m=await x.delete(t,n),h=(e=m==null?void 0:m.data)==null?void 0:e.message;h&&this.notificationState.showSuccessNotification(h),this.$emit("deleted",this.departmentIds),s()}catch(t){const n=((o=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:o.message)||(t==null?void 0:t.message)||"Something went wrong while deleting departments";this.notificationState.showWarningNotification(n)}finally{this.isDeleting=!1}}}}},ue={class:"flex space-x-2 items-center p-4 text-xs bg-red-50 text-red-500 border border-red-200 border-dashed rounded-lg mb-8"};function ge(s,e,a,o,t,n){const m=c("CircleAlert"),h=c("Modal");return l(),v(h,{size:"sm",ref:"modal",approveType:"danger",approveIcon:"delete",isLoading:t.isDeleting,approveAction:n.onDelete,approveText:n.approveText,header:"Delete Departments"},{content:f(()=>[r("div",ue,[p(m,{size:"20"}),r("span",null," Are you sure you want to delete "+D(n.total>1?`these ${n.total} departments`:"this 1 department")+"? ",1)])]),_:1},8,["isLoading","approveAction","approveText"])}const fe=S(he,[["render",ge]]),De={inject:["formState","notificationState"],components:{Pill:W,Modal:y,Input:I,Button:G,Popover:Q,Dropdown:J,Table:B,AddDepartmentModal:se,UpdateDepartmentModal:ie,DeleteDepartmentModal:me,DeleteDepartmentsModal:fe,UsersRoundIcon:A},data(){return{Plus:Z,Pencil:X,Trash2:T,perPage:"15",UsersRoundIcon:A,departments:[],getCountryName:j,checkedRows:[],pagination:null,searchTerm:null,selectAll:!1,filterExpressions:[],sortingExpressions:[],isLoadingDepartments:!1,columns:this.prepareColumns(),dropdownOptions:[{icon:T,label:"Delete",action:this.showDeleteDepartmentsModal}]}},watch:{selectAll(s){this.checkedRows=this.departments.reduce((e,a)=>(e[a.id]=s,e),{})}},computed:{hasSearchTerm(){return this.searchTerm!=null&&this.searchTerm.trim()!==""},totalCheckedRows(){return Object.values(this.checkedRows).filter(Boolean).length},hasFilterExpressions(){return this.filterExpressions.length>0},hasSortingExpressions(){return this.sortingExpressions.length>0},showTable(){var s;return this.isLoadingDepartments||((s=(this.pagination??{}).meta)==null?void 0:s.total)>0||this.hasSearchTerm||this.hasFilterExpressions||this.hasSortingExpressions}},methods:{formattedDatetime:H,formattedRelativeDate:Y,prepareColumns(){const s=["Name","Organization","Country","Queues","Created Date"],e=["Name","Organization","Country","Queues","Created Date"];return s.map(a=>({name:a,active:e.includes(a),priority:e.includes(a)}))},showAddDepartmentModal(){this.$refs.addDepartmentModal.showModal()},showUpdateDepartmentModal(s){this.$refs.updateDepartmentModal.showModal(s)},showDeleteDepartmentModal(s){this.$refs.deleteDepartmentModal.showModal(s)},showDeleteDepartmentsModal(){const s=this.departments.filter(e=>this.checkedRows[e.id]).map(e=>e.id);this.$refs.deleteDepartmentsModal.showModal(s)},onDepartmentDeleted(s){this.departments=this.departments.filter(e=>e.id!==s),this.departments.length===0&&this.fetchDepartments()},onDepartmentsDeleted(s=[]){s.forEach(e=>{this.checkedRows[e]!==void 0&&(this.checkedRows[e]=!1)}),this.selectAll=!1,this.departments=this.departments.filter(e=>!s.includes(e.id)),this.departments.length===0&&this.fetchDepartments()},paginate(s){this.fetchDepartments(s)},search(s){this.searchTerm=s,this.fetchDepartments()},updatedColumns(s){this.columns=s},updatedFilters(s){const e=s.map(a=>a.expression);E(this.filterExpressions,e)||(this.filterExpressions=e,this.fetchDepartments())},updatedSorting(s){const e=s.map(a=>a.expression);E(this.sortingExpressions,e)||(this.sortingExpressions=e,this.fetchDepartments())},updatedPerPage(s){this.perPage=s,this.fetchDepartments()},async fetchDepartments(s=null){var e,a;try{this.isLoadingDepartments=!0,s=s??"/api/departments";let o={params:{per_page:this.perPage,_relationships:"organization",_countable_relationships:"queues"}};this.hasSearchTerm&&(o.params.search=this.searchTerm),this.hasFilterExpressions&&(o.params._filters=this.filterExpressions.join("|")),this.hasSortingExpressions&&(o.params._sort=this.sortingExpressions.join("|"));const t=await x.get(s,o);this.pagination=t.data,this.departments=this.pagination.data,this.checkedRows=this.departments.reduce((n,m)=>(n[m.id]=!1,n),{})}catch(o){const t=((a=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:a.message)||(o==null?void 0:o.message)||"Something went wrong while fetching departments";this.notificationState.showWarningNotification(t),console.error("Failed to fetch departments:",o)}finally{this.isLoadingDepartments=!1}}},created(){this.isLoadingDepartments=!0,this.searchTerm=this.$route.query.searchTerm,this.$route.query.filterExpressions&&(this.filterExpressions=this.$route.query.filterExpressions.split("|")),this.$route.query.sortingExpressions&&(this.sortingExpressions=this.$route.query.sortingExpressions.split("|")),this.fetchDepartments()}},we={class:"select-none min-h-screen bg-gray-50 pt-8 p-4 sm:p-8 space-y-4 sm:space-y-6"},_e={class:"flex justify-between"},xe={class:"flex items-end space-x-2"},ye={class:"flex justify-end"},Se={class:"border-b border-indigo-200"},be={scope:"col",class:"whitespace-nowrap align-top font-semibold px-4 py-2.5"},ve=["onClick"],Me={key:0,class:"whitespace-nowrap align-center pr-4 py-4"},ze={key:1,class:"whitespace-nowrap align-center pr-4 py-4"},ke={key:0,class:"flex items-center space-x-2"},Ce={class:"whitespace-nowrap"},Ee={key:2,class:"whitespace-nowrap align-center pr-4 py-4"},Te={key:0,class:"flex items-center space-x-2"},Ae={class:"flex items-center space-x-2"},Ie=["src","alt"],Pe={key:3,class:"whitespace-nowrap align-center text-center pr-4 py-4"},Ue={key:4,class:"whitespace-nowrap align-center pr-4 py-4"},Ne={class:"flex space-x-1 items-center"},Re={class:"h-16 pr-4 py-4 flex align-middle items-center space-x-2"},Fe={key:1,class:"select-none w-full flex justify-center py-16"},Le={class:"max-w-sm w-full bg-white shadow-sm rounded-xl p-6 flex flex-col items-center text-center space-y-4 border border-dashed border-gray-200"};function Ve(s,e,a,o,t,n){const m=c("UsersRoundIcon"),h=c("Button"),M=c("Dropdown"),w=c("Input"),P=c("Popover"),U=c("Table"),N=c("AddDepartmentModal"),R=c("UpdateDepartmentModal"),F=c("DeleteDepartmentModal"),L=c("DeleteDepartmentsModal");return l(),d("div",we,[n.showTable?(l(),d(_,{key:0},[r("div",_e,[r("div",xe,[p(m,{size:"48","stroke-width":"1",class:"text-gray-400"}),e[2]||(e[2]=r("div",null,[r("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white"},"Departments"),r("p",{class:"text-sm text-gray-600 dark:text-neutral-400"}," Manage departments within your organization ")],-1))]),r("div",ye,[p(h,{type:"primary",size:"md",leftIcon:t.Plus,leftIconSize:"20",action:n.showAddDepartmentModal},{default:f(()=>e[3]||(e[3]=[r("span",null,"Add Department",-1)])),_:1},8,["leftIcon","action"])])]),p(U,{onSearch:n.search,columns:t.columns,perPage:t.perPage,onPaginate:n.paginate,resource:"departments",searchTerm:t.searchTerm,pagination:t.pagination,onRefresh:n.fetchDepartments,onUpdatedColumns:n.updatedColumns,onUpdatedFilters:n.updatedFilters,onUpdatedSorting:n.updatedSorting,onUpdatedPerPage:n.updatedPerPage,isLoading:t.isLoadingDepartments,filterExpressions:t.filterExpressions,sortingExpressions:t.sortingExpressions},{belowToolbar:f(()=>[r("div",{class:k([{hidden:n.totalCheckedRows===0},"bg-gray-50 border flex items-center mb-2 p-4 rounded-lg shadow space-x-2"])},[e[4]||(e[4]=r("span",{class:"text-sm"},"Actions: ",-1)),p(M,{triggerSize:"sm",options:t.dropdownOptions,triggerText:`Select Action (${n.totalCheckedRows} selected)`},null,8,["options","triggerText"])],2)]),head:f(()=>[r("tr",Se,[r("th",be,[p(w,{type:"checkbox",modelValue:t.selectAll,"onUpdate:modelValue":e[0]||(e[0]=i=>t.selectAll=i)},null,8,["modelValue"])]),(l(!0),d(_,null,z(t.columns,(i,g)=>(l(),d(_,{key:g},[i.active?(l(),d("th",{key:0,scope:"col",class:k(["whitespace-nowrap align-top font-semibold pr-4 py-2.5",{"text-center":["Users"].includes(i.name)}])},D(i.name),3)):u("",!0)],64))),128)),e[5]||(e[5]=r("th",{scope:"col",class:"whitespace-nowrap align-top font-semibold pr-4 py-2.5"},"Actions",-1))])]),body:f(()=>[(l(!0),d(_,null,z(t.departments,i=>(l(),d("tr",{key:i.id,onClick:C(g=>s.onView(i),["stop"]),class:k([t.checkedRows[i.id]?"bg-blue-50":"bg-white hover:bg-gray-50","group cursor-pointer text-sm border-b border-gray-200"])},[r("td",{onClick:e[1]||(e[1]=C(()=>{},["stop"])),class:"whitespace-nowrap align-top px-4 py-4"},[p(w,{type:"checkbox",modelValue:t.checkedRows[i.id],"onUpdate:modelValue":g=>t.checkedRows[i.id]=g},null,8,["modelValue","onUpdate:modelValue"])]),(l(!0),d(_,null,z(t.columns,(g,V)=>(l(),d(_,{key:V},[g.name=="Name"?(l(),d("td",Me,[r("div",null,D(i.name),1)])):u("",!0),g.name=="Organization"?(l(),d("td",ze,[i.organization?(l(),d("div",ke,[e[6]||(e[6]=r("img",{src:"https://placehold.co/21x24",class:"size-8 rounded-lg shrink-0",alt:"Logo"},null,-1)),r("div",Ce,D(i.organization.name),1)])):u("",!0)])):u("",!0),g.name=="Country"?(l(),d("td",Ee,[i.organization?(l(),d("div",Te,[r("div",Ae,[i.organization.country?(l(),d("img",{key:0,src:`/svgs/country-flags/${i.organization.country.toLowerCase()}.svg`,alt:i.organization.country,class:"w-5 h-4 rounded-sm object-cover"},null,8,Ie)):u("",!0),r("span",null,D(t.getCountryName(i.organization.country)),1)])])):u("",!0)])):u("",!0),g.name=="Queues"?(l(),d("td",Pe,[r("span",null,D(i.queues_count),1)])):u("",!0),g.name=="Created Date"?(l(),d("td",Ue,[r("div",Ne,[r("span",null,D(n.formattedDatetime(i.created_at)),1),p(P,{placement:"top",class:"opacity-0 group-hover:opacity-100",content:n.formattedRelativeDate(i.created_at)},null,8,["content"])])])):u("",!0)],64))),128)),r("td",Re,[p(h,{type:"bare",size:"xs",leftIcon:t.Pencil,leftIconSize:"16",action:()=>n.showUpdateDepartmentModal(i)},null,8,["leftIcon","action"]),p(h,{type:"bareDanger",size:"xs",leftIcon:t.Trash2,leftIconSize:"16",action:()=>n.showDeleteDepartmentModal(i)},null,8,["leftIcon","action"])])],10,ve))),128))]),_:1},8,["onSearch","columns","perPage","onPaginate","searchTerm","pagination","onRefresh","onUpdatedColumns","onUpdatedFilters","onUpdatedSorting","onUpdatedPerPage","isLoading","filterExpressions","sortingExpressions"])],64)):(l(),d("div",Fe,[r("div",Le,[p(m,{size:"48",class:"text-gray-400"}),e[8]||(e[8]=r("h2",{class:"text-2xl font-bold text-gray-800"},"No Departments Yet",-1)),e[9]||(e[9]=r("p",{class:"text-sm text-gray-500"},"Add a department to manage organizational units.",-1)),p(h,{type:"primary",size:"md",leftIcon:t.Plus,leftIconSize:"20",action:n.showAddDepartmentModal},{default:f(()=>e[7]||(e[7]=[r("span",null,"Add Department",-1)])),_:1},8,["leftIcon","action"])])])),p(N,{ref:"addDepartmentModal",onCreated:n.fetchDepartments},null,8,["onCreated"]),p(R,{ref:"updateDepartmentModal",onUpdated:n.fetchDepartments},null,8,["onUpdated"]),p(F,{ref:"deleteDepartmentModal",onDeleted:n.onDepartmentDeleted},null,8,["onDeleted"]),p(L,{ref:"deleteDepartmentsModal",onDeleted:n.onDepartmentsDeleted},null,8,["onDeleted"])])}const nt=S(De,[["render",Ve]]);export{nt as default};
