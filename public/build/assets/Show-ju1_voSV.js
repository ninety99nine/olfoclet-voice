import{c as r,d as n,F as m,a as l,r as p,w as u,j as z,G as L,o as a,h as w,n as R,i as b,b as f,t as y,e as N}from"./app-Du355Hwa.js";import{T as V,M as F,P as j,i as M,a as k}from"./Table-Ukz-LVMs.js";import{P as B,I as q}from"./Input-Ce6sOWCE.js";import{B as O}from"./Button-QuQuG-sh.js";import{f as G,a as W,D as Y}from"./dateUtils-BxSzW5yy.js";import{D as H,a as J,U as K,A as Q}from"./DeleteRolesModal-CUvCPHLf.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{L as P}from"./mail-CmabDzCr.js";import{P as Z}from"./pencil-CpKEG2hD.js";import{P as $}from"./plus-Cw5wWZrK.js";import"./createLucideIcon-CQR3ABw7.js";import"./Tooltip-Bh561etO.js";import"./Drawer-EX-MXofE.js";import"./arrow-up-CiGeyIVi.js";import"./Switch-C9_nwvxw.js";import"./vue-draggable-next.esm-bundler-Bt-FJ2_7.js";import"./circle-alert-BxAnEgKy.js";const ee={inject:["formState","notificationState"],components:{Pill:j,Modal:F,Input:q,Button:O,Popover:B,Dropdown:Y,Table:V,AddRoleModal:Q,UpdateRoleModal:K,DeleteRoleModal:J,DeleteRolesModal:H,Lock:P},data(){return{Plus:$,Pencil:Z,Trash2:k,Lock:P,roles:[],perPage:"15",getCountryName:L,checkedRows:[],pagination:null,searchTerm:null,selectAll:!1,filterExpressions:[],sortingExpressions:[],isLoadingRoles:!1,columns:this.prepareColumns(),dropdownOptions:[{icon:k,label:"Delete",action:this.showDeleteRolesModal}]}},watch:{selectAll(s){this.checkedRows=this.roles.reduce((e,d)=>(e[d.id]=s,e),{})}},computed:{hasSearchTerm(){return this.searchTerm!=null&&this.searchTerm.trim()!==""},totalCheckedRows(){return Object.values(this.checkedRows).filter(Boolean).length},hasFilterExpressions(){return this.filterExpressions.length>0},hasSortingExpressions(){return this.sortingExpressions.length>0},showTable(){var s;return this.isLoadingRoles||((s=(this.pagination??{}).meta)==null?void 0:s.total)>0||this.hasSearchTerm||this.hasFilterExpressions||this.hasSortingExpressions}},methods:{formattedDatetime:W,formattedRelativeDate:G,prepareColumns(){const s=["Name","Permissions","Users","Created Date"],e=["Name","Permissions","Users","Created Date"];return s.map(d=>({name:d,active:e.includes(d),priority:e.includes(d)}))},showAddRoleModal(){this.$refs.addRoleModal.showModal()},showUpdateRoleModal(s){this.$refs.updateRoleModal.showModal(s)},showDeleteRoleModal(s){this.$refs.deleteRoleModal.showModal(s)},showDeleteRolesModal(){const s=this.roles.filter(e=>this.checkedRows[e.id]).map(e=>e.id);this.$refs.deleteRolesModal.showModal(s)},onRoleDeleted(s){this.roles=this.roles.filter(e=>e.id!==s),this.roles.length===0&&this.fetchRoles()},onRolesDeleted(s=[]){s.forEach(e=>{this.checkedRows[e]!==void 0&&(this.checkedRows[e]=!1)}),this.selectAll=!1,this.roles=this.roles.filter(e=>!s.includes(e.id)),this.roles.length===0&&this.fetchRoles()},paginate(s){this.fetchRoles(s)},search(s){this.searchTerm=s,this.fetchRoles()},updatedColumns(s){this.columns=s},updatedFilters(s){const e=s.map(d=>d.expression);M(this.filterExpressions,e)||(this.filterExpressions=e,this.fetchRoles())},updatedSorting(s){const e=s.map(d=>d.expression);M(this.sortingExpressions,e)||(this.sortingExpressions=e,this.fetchRoles())},updatedPerPage(s){this.perPage=s,this.fetchRoles()},async fetchRoles(s=null){var e,d;try{this.isLoadingRoles=!0,s=s??"/api/roles";let c={params:{per_page:this.perPage,_relationships:"organization",_countable_relationships:"users"}};this.hasSearchTerm&&(c.params.search=this.searchTerm),this.hasFilterExpressions&&(c.params._filters=this.filterExpressions.join("|")),this.hasSortingExpressions&&(c.params._sort=this.sortingExpressions.join("|"));const t=await z.get(s,c);this.pagination=t.data,this.roles=this.pagination.data,this.checkedRows=this.roles.reduce((o,g)=>(o[g.id]=!1,o),{})}catch(c){const t=((d=(e=c==null?void 0:c.response)==null?void 0:e.data)==null?void 0:d.message)||(c==null?void 0:c.message)||"Something went wrong while fetching roles";this.notificationState.showWarningNotification(t),console.error("Failed to fetch roles:",c)}finally{this.isLoadingRoles=!1}}},created(){this.isLoadingRoles=!0,this.searchTerm=this.$route.query.searchTerm,this.$route.query.filterExpressions&&(this.filterExpressions=this.$route.query.filterExpressions.split("|")),this.$route.query.sortingExpressions&&(this.sortingExpressions=this.$route.query.sortingExpressions.split("|")),this.fetchRoles()}},se={class:"select-none min-h-screen bg-gray-50 pt-8 p-4 sm:p-8 space-y-4 sm:space-y-6"},te={class:"flex justify-between"},oe={class:"flex items-end space-x-2"},le={class:"flex justify-end"},ie={class:"border-b border-indigo-200"},ne={scope:"col",class:"whitespace-nowrap align-top font-semibold px-4 py-2.5"},re=["onClick"],ae={key:0,class:"whitespace-nowrap align-center pr-4 py-4"},de={key:1,class:"whitespace-nowrap align-center text-center pr-4 py-4"},ce={key:2,class:"whitespace-nowrap align-center text-center pr-4 py-4"},pe={key:3,class:"whitespace-nowrap align-center pr-4 py-4"},he={class:"flex space-x-1 items-center"},me={class:"h-16 pr-4 py-4 flex align-middle items-center space-x-2"},ue={key:1,class:"select-none w-full flex justify-center py-16"},fe={class:"max-w-sm w-full bg-white shadow-sm rounded-xl p-6 flex flex-col items-center text-center space-y-4 border border-dashed border-gray-200"};function ge(s,e,d,c,t,o){const g=p("Lock"),x=p("Button"),D=p("Dropdown"),_=p("Input"),E=p("Pill"),S=p("Popover"),T=p("Table"),C=p("AddRoleModal"),U=p("UpdateRoleModal"),v=p("DeleteRoleModal"),A=p("DeleteRolesModal");return a(),r("div",se,[o.showTable?(a(),r(m,{key:0},[l("div",te,[l("div",oe,[n(g,{size:"48","stroke-width":"1",class:"text-gray-400"}),e[2]||(e[2]=l("div",null,[l("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white"},"Roles"),l("p",{class:"text-sm text-gray-600 dark:text-neutral-400"}," Manage roles for your organization ")],-1))]),l("div",le,[n(x,{type:"primary",size:"md",leftIcon:t.Plus,leftIconSize:"20",action:o.showAddRoleModal},{default:u(()=>e[3]||(e[3]=[l("span",null,"Add Role",-1)])),_:1},8,["leftIcon","action"])])]),n(T,{resource:"roles",onSearch:o.search,columns:t.columns,perPage:t.perPage,onPaginate:o.paginate,onRefresh:o.fetchRoles,searchTerm:t.searchTerm,pagination:t.pagination,isLoading:t.isLoadingRoles,onUpdatedColumns:o.updatedColumns,onUpdatedFilters:o.updatedFilters,onUpdatedSorting:o.updatedSorting,onUpdatedPerPage:o.updatedPerPage,filterExpressions:t.filterExpressions,sortingExpressions:t.sortingExpressions},{belowToolbar:u(()=>[l("div",{class:R([{hidden:o.totalCheckedRows===0},"bg-gray-50 border flex items-center mb-2 p-4 rounded-lg shadow space-x-2"])},[e[4]||(e[4]=l("span",{class:"text-sm"},"Actions: ",-1)),n(D,{triggerSize:"sm",options:t.dropdownOptions,triggerText:`Select Action (${o.totalCheckedRows} selected)`},null,8,["options","triggerText"])],2)]),head:u(()=>[l("tr",ie,[l("th",ne,[n(_,{type:"checkbox",modelValue:t.selectAll,"onUpdate:modelValue":e[0]||(e[0]=i=>t.selectAll=i)},null,8,["modelValue"])]),(a(!0),r(m,null,w(t.columns,(i,h)=>(a(),r(m,{key:h},[i.active?(a(),r("th",{key:0,scope:"col",class:R(["whitespace-nowrap align-top font-semibold pr-4 py-2.5",{"text-center":["Users"].includes(i.name)}])},y(i.name),3)):f("",!0)],64))),128)),e[5]||(e[5]=l("th",{scope:"col",class:"whitespace-nowrap align-top font-semibold pr-4 py-2.5"},"Actions",-1))])]),body:u(()=>[(a(!0),r(m,null,w(t.roles,i=>(a(),r("tr",{onClick:b(h=>s.onView(i),["stop"]),key:i.id,class:R([t.checkedRows[i.id]?"bg-blue-50":"bg-white hover:bg-gray-50","group cursor-pointer text-sm border-b border-gray-200"])},[l("td",{onClick:e[1]||(e[1]=b(()=>{},["stop"])),class:"whitespace-nowrap align-top px-4 py-4"},[n(_,{type:"checkbox",modelValue:t.checkedRows[i.id],"onUpdate:modelValue":h=>t.checkedRows[i.id]=h},null,8,["modelValue","onUpdate:modelValue"])]),(a(!0),r(m,null,w(t.columns,(h,I)=>(a(),r(m,{key:I},[h.name=="Name"?(a(),r("td",ae,[l("div",null,y(i.name),1)])):f("",!0),h.name=="Permissions"?(a(),r("td",de,[n(E,{type:"light",size:"xs"},{default:u(()=>e[6]||(e[6]=[N("9")])),_:1})])):f("",!0),h.name=="Users"?(a(),r("td",ce,e[7]||(e[7]=[l("span",null,"3",-1)]))):f("",!0),h.name=="Created Date"?(a(),r("td",pe,[l("div",he,[l("span",null,y(o.formattedDatetime(i.createdAt)),1),n(S,{placement:"top",class:"opacity-0 group-hover:opacity-100",content:o.formattedRelativeDate(i.createdAt)},null,8,["content"])])])):f("",!0)],64))),128)),l("td",me,[n(x,{type:"bare",size:"xs",leftIcon:t.Pencil,leftIconSize:"16",action:()=>o.showUpdateRoleModal(i)},null,8,["leftIcon","action"]),n(x,{type:"bareDanger",size:"xs",leftIcon:t.Trash2,leftIconSize:"16",action:()=>o.showDeleteRoleModal(i)},null,8,["leftIcon","action"])])],10,re))),128))]),_:1},8,["onSearch","columns","perPage","onPaginate","onRefresh","searchTerm","pagination","isLoading","onUpdatedColumns","onUpdatedFilters","onUpdatedSorting","onUpdatedPerPage","filterExpressions","sortingExpressions"])],64)):(a(),r("div",ue,[l("div",fe,[n(g,{size:"48",class:"text-gray-400"}),e[9]||(e[9]=l("h2",{class:"text-2xl font-bold text-gray-800"},"No Roles Yet",-1)),e[10]||(e[10]=l("p",{class:"text-sm text-gray-500"},"Add a role to manage access control.",-1)),n(x,{type:"primary",size:"md",leftIcon:t.Plus,leftIconSize:"20",action:o.showAddRoleModal},{default:u(()=>e[8]||(e[8]=[l("span",null,"Add Role",-1)])),_:1},8,["leftIcon","action"])])])),n(C,{ref:"addRoleModal",onCreated:o.fetchRoles},null,8,["onCreated"]),n(U,{ref:"updateRoleModal",onUpdated:o.fetchRoles},null,8,["onUpdated"]),n(v,{ref:"deleteRoleModal",onDeleted:o.onRoleDeleted},null,8,["onDeleted"]),n(A,{ref:"deleteRolesModal",onDeleted:o.onRolesDeleted},null,8,["onDeleted"])])}const Ie=X(ee,[["render",ge]]);export{Ie as default};
