import{i as m,m as g,w as c,r as l,o as p,a as h,d as f,j as y,c as M,b as R,e as w,t as z}from"./app-Bh0CRPT1.js";import{S as v,M as u}from"./Table-C-dAgqL-.js";import{I as x}from"./Input-DLLHQFCa.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as D}from"./circle-alert-BnPEXNJk.js";const A={components:{Modal:u,Input:x,Select:v},inject:["formState","notificationState"],data(){return{isCreating:!1,form:{name:"",organization_id:null},organizationOptions:[]}},methods:{showModal(){this.reset(),this.fetchOrganizations(),this.$refs.modal.showModal()},reset(){this.form.name="",this.form.organization_id=null},async fetchOrganizations(){var a;try{const t=await m.get("/api/organizations");this.organizationOptions=(((a=t.data)==null?void 0:a.data)??[]).map(r=>({label:r.name,value:r.id}))}catch(t){console.error("Failed to load organizations:",t)}},async createRole(a){var t,r;if(this.formState.hideFormErrors(),this.form.name.trim()===""&&this.formState.setFormError("name","Role name is required"),this.form.organization_id||this.formState.setFormError("organization_id","Organization is required"),!this.formState.hasErrors){this.isCreating=!0;try{const o={...this.form};await m.post("/api/roles",o,{params:{organization_id:this.form.organization_id}}),this.notificationState.showSuccessNotification("Role created"),this.$emit("created"),a()}catch(o){const e=((r=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:r.message)||(o==null?void 0:o.message)||"Something went wrong trying to create the role";this.notificationState.showWarningNotification(e),this.formState.setServerFormErrors(o),console.error("Failed to create role:",o)}finally{this.isCreating=!1}}}}},b={class:"space-y-4"};function F(a,t,r,o,e,i){const n=l("Input"),d=l("Select"),S=l("Modal");return p(),g(S,{size:"sm",ref:"modal",showFooter:!0,dismissable:!0,scrollOnContent:!1,showApproveButton:!0,header:"Create New Role",approveText:"Create Role",approveAction:i.createRole,approveLoading:e.isCreating,subheader:"Add a new role to the platform"},{trigger:c(s=>[y(a.$slots,"default",{showModal:s.showModal})]),content:c(()=>[h("div",b,[f(n,{modelValue:e.form.name,"onUpdate:modelValue":t[0]||(t[0]=s=>e.form.name=s),showAsterisk:!0,label:"Role Name",placeholder:"Enter role name",errorText:i.formState.getFormError("name")},null,8,["modelValue","errorText"]),f(d,{modelValue:e.form.organization_id,"onUpdate:modelValue":t[1]||(t[1]=s=>e.form.organization_id=s),options:e.organizationOptions,label:"Organization",placeholder:"Select organization",errorText:i.formState.getFormError("organization_id")},null,8,["modelValue","options","errorText"])])]),_:3},8,["approveAction","approveLoading"])}const G=_(A,[["render",F]]),T={name:"UpdateRoleModal",inject:["formState","notificationState"],components:{Modal:u,Input:x,Select:v},data(){return{isUpdating:!1,role:null,form:{name:"",organization_id:null},organizationOptions:[]}},methods:{showModal(a){this.reset(),this.role=a,this.form.name=a.name,this.form.organization_id=a.organization_id,this.fetchOrganizations(),this.$refs.modal.showModal()},reset(){this.form.name="",this.form.organization_id=null,this.role=null},async fetchOrganizations(){var a;try{const t=await m.get("/api/organizations");this.organizationOptions=(((a=t.data)==null?void 0:a.data)??[]).map(r=>({label:r.name,value:r.id}))}catch(t){console.error("Failed to load organizations:",t)}},async updateRole(a){var t,r;if(this.formState.hideFormErrors(),this.form.name.trim()===""&&this.formState.setFormError("name","Role name is required"),this.form.organization_id||this.formState.setFormError("organization_id","Organization is required"),!this.formState.hasErrors){this.isUpdating=!0;try{const o=this.role._links.update_role,e={name:this.form.name,organization_id:this.form.organization_id};await m.put(o,e),this.notificationState.showSuccessNotification("Role updated"),this.$emit("updated"),a()}catch(o){const e=((r=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:r.message)||(o==null?void 0:o.message)||"Something went wrong updating the role";this.notificationState.showWarningNotification(e),this.formState.setServerFormErrors(o),console.error("Failed to update role:",o)}finally{this.isUpdating=!1}}}}},C={class:"space-y-4"};function E(a,t,r,o,e,i){const n=l("Input"),d=l("Select"),S=l("Modal");return p(),g(S,{size:"sm",ref:"modal",showFooter:!0,dismissable:!0,scrollOnContent:!1,showApproveButton:!0,approveLoading:e.isUpdating,header:"Update Role",approveText:"Update Role",approveAction:i.updateRole,subheader:"Modify the role's details"},{content:c(()=>[h("div",C,[f(n,{modelValue:e.form.name,"onUpdate:modelValue":t[0]||(t[0]=s=>e.form.name=s),showAsterisk:!0,label:"Role Name",placeholder:"e.g. Supervisor",errorText:i.formState.getFormError("name")},null,8,["modelValue","errorText"]),f(d,{modelValue:e.form.organization_id,"onUpdate:modelValue":t[1]||(t[1]=s=>e.form.organization_id=s),options:e.organizationOptions,showAsterisk:!0,label:"Organization",placeholder:"Select organization",errorText:i.formState.getFormError("organization_id")},null,8,["modelValue","options","errorText"])])]),_:1},8,["approveLoading","approveAction"])}const H=_(T,[["render",E]]),O={components:{Modal:u},inject:["notificationState"],data(){return{role:null,isDeleting:!1}},methods:{showModal(a){this.role=a,this.$refs.modal.showModal()},async onDelete(a){var t,r,o;if(this.role){this.isDeleting=!0;try{const e=this.role._links.delete_role,i=await m.delete(e);(t=i==null?void 0:i.data)!=null&&t.message&&this.notificationState.showSuccessNotification(i.data.message),this.$emit("deleted",this.role.id),a()}catch(e){const i=((o=(r=e==null?void 0:e.response)==null?void 0:r.data)==null?void 0:o.message)||(e==null?void 0:e.message)||"Something went wrong while deleting the role";this.notificationState.showWarningNotification(i)}finally{this.isDeleting=!1}}}}},V={key:0,class:"text-sm text-gray-700 dark:text-neutral-400"},N={class:"font-bold text-black"};function I(a,t,r,o,e,i){const n=l("Modal");return p(),g(n,{size:"sm",ref:"modal",approveType:"danger",header:"Confirm Delete",isLoading:e.isDeleting,approveAction:i.onDelete,approveText:"Delete Role"},{content:c(()=>[e.role?(p(),M("p",V,[t[0]||(t[0]=w(" Are you sure you want to permanently delete ")),h("span",N,z(e.role.name),1),t[1]||(t[1]=w("? "))])):R("",!0)]),_:1},8,["isLoading","approveAction"])}const J=_(O,[["render",I]]),U={inject:["notificationState"],components:{Modal:u,CircleAlert:D},data(){return{isDeleting:!1,roleIds:[]}},computed:{total(){return this.roleIds.length},approveText(){return this.total===1?"Delete Role":"Delete Roles"}},methods:{showModal(a=[]){this.roleIds=a,this.$refs.modal.showModal()},async onDelete(a){var t,r,o;if(!(this.isDeleting||this.roleIds.length===0)){this.isDeleting=!0;try{const e="/api/roles",i={data:{role_ids:this.roleIds}},n=await m.delete(e,i),d=(t=n==null?void 0:n.data)==null?void 0:t.message;d&&this.notificationState.showSuccessNotification(d),this.$emit("deleted",this.roleIds),a()}catch(e){const i=((o=(r=e==null?void 0:e.response)==null?void 0:r.data)==null?void 0:o.message)||(e==null?void 0:e.message)||"Something went wrong while deleting roles";this.notificationState.showWarningNotification(i)}finally{this.isDeleting=!1}}}}},k={class:"flex space-x-2 items-center p-4 text-xs bg-red-50 text-red-500 border border-red-200 border-dashed rounded-lg mb-8"};function L(a,t,r,o,e,i){const n=l("CircleAlert"),d=l("Modal");return p(),g(d,{size:"sm",ref:"modal",approveType:"danger",approveIcon:"delete",isLoading:e.isDeleting,approveAction:i.onDelete,approveText:i.approveText,header:"Delete Roles"},{content:c(()=>[h("div",k,[f(n,{size:"20"}),h("span",null," Are you sure you want to delete "+z(i.total>1?`these ${i.total} roles`:"this 1 role")+"? ",1)])]),_:1},8,["isLoading","approveAction","approveText"])}const K=_(U,[["render",L]]);export{G as A,K as D,H as U,J as a};
