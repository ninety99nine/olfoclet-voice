import{c as n,a as s,t as r,F as g,h as u,i as p,I as m,ad as f,ak as y,j as l,H as x,o as a,n as c,e as _,b as h}from"./app-DB903dGk.js";import{_ as w}from"./_plugin-vue_export-helper-DlAUqK2U.js";const b={name:"WhatsAppChat",data(){return{messages:[],newMessage:"",loading:!0,error:null,sending:!1,pusher:null,channel:null}},computed:{organizationId(){var i;return((i=x().user)==null?void 0:i.organization_id)||null}},async mounted(){await this.fetchMessages(),this.setupPusher()},beforeUnmount(){this.channel&&(this.channel.unbind("new-message"),this.pusher.disconnect())},methods:{async fetchMessages(){if(!this.organizationId){this.error="Organization ID not found. Please log in again.",this.loading=!1;return}try{const e=await l.get("/api/omni-channel-messages",{params:{organization_id:this.organizationId,channel:"whatsapp"}});this.messages=e.data.data||[],this.loading=!1}catch(e){this.error="Failed to load messages. Please try again.",this.loading=!1,console.error("Error fetching messages:",e)}},async sendMessage(){if(this.newMessage.trim()){this.sending=!0;try{const e=await l.post("/api/omni-channel-messages",{organization_id:this.organizationId,channel:"whatsapp",direction:"outbound",from:"telcoflo",to:"26775993221",content:this.newMessage,message_type:"text"});this.messages.push(e.data.data),this.newMessage=""}catch(e){console.error("Error sending message:",e),this.error="Failed to send message. Please try again."}finally{this.sending=!1}}},setupPusher(){this.organizationId&&(this.pusher=new y("your-pusher-app-key",{cluster:"your-pusher-cluster",encrypted:!0}),this.channel=this.pusher.subscribe(`whatsapp-messages.${this.organizationId}`),this.channel.bind("new-message",e=>{e.channel==="whatsapp"&&e.direction==="inbound"&&this.messages.push(e)}))}}},v={class:"flex flex-col h-screen bg-gray-100"},k={class:"flex-1 p-4 overflow-y-auto space-y-4"},M={key:0,class:"text-center text-gray-500"},z={key:1,class:"text-center text-red-500"},I={key:2,class:"text-center text-gray-500"},S={key:3},A={class:"text-xs mt-1 opacity-75"},C={key:0,class:"ml-1"},P={key:1,class:"ml-1 text-blue-400"},W={class:"bg-white p-4 border-t border-gray-200"},D=["disabled"],F={key:0},N={key:1};function T(e,i,V,j,o,d){return a(),n("div",v,[i[2]||(i[2]=s("div",{class:"bg-indigo-600 text-white p-4 flex items-center space-x-3"},[s("img",{src:"/images/channels/whatsapp.png",alt:"WhatsApp",class:"w-10 h-10"}),s("div",null,[s("h1",{class:"text-xl font-semibold"},"WhatsApp Chat"),s("p",{class:"text-sm"},"Chat with your contacts via WhatsApp")])],-1)),s("div",k,[o.loading?(a(),n("div",M,"Loading messages...")):o.error?(a(),n("div",z,r(o.error),1)):o.messages.length===0?(a(),n("div",I,"No messages yet. Start a conversation!")):(a(),n("div",S,[(a(!0),n(g,null,u(o.messages,t=>(a(),n("div",{key:t.id,class:c(["flex",t.direction==="outbound"?"justify-end":"justify-start"])},[s("div",{class:c(["max-w-xs md:max-w-md p-3 rounded-lg shadow",t.direction==="outbound"?"bg-indigo-500 text-white":"bg-white text-gray-800"])},[s("p",null,r(t.content),1),s("p",A,[_(r(new Date(t.created_at).toLocaleTimeString())+" ",1),t.status==="delivered"?(a(),n("span",C,"✓✓")):h("",!0),t.status==="read"?(a(),n("span",P,"✓✓")):h("",!0)])],2)],2))),128))]))]),s("div",W,[s("form",{onSubmit:i[1]||(i[1]=p((...t)=>d.sendMessage&&d.sendMessage(...t),["prevent"])),class:"flex items-center space-x-3"},[m(s("input",{"onUpdate:modelValue":i[0]||(i[0]=t=>o.newMessage=t),type:"text",placeholder:"Type your message...",class:"flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",required:""},null,512),[[f,o.newMessage]]),s("button",{type:"submit",class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500",disabled:o.sending},[o.sending?(a(),n("span",F,"Sending...")):(a(),n("span",N,"Send"))],8,D)],32)])])}const L=w(b,[["render",T],["__scopeId","data-v-645dbe97"]]);export{L as default};
