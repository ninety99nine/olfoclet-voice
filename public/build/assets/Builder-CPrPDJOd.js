import{c as m,a as t,d as s,r,o as u,m as S,w as b,F as H,l as M,p as T,t as F,L as N,i as w,M as f}from"./app-Bh0CRPT1.js";import{C as x,_ as g,M as k,a as D,b as j,c as q,d as A,e as R,S as O}from"./vue-flow-background-CNivp8kz.js";import{B as V}from"./Button-D-J7vJoA.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as y}from"./settings-Ssha0Pkn.js";import{c as z}from"./createLucideIcon-C9p8Jo51.js";import{F as $}from"./file-text-Cj8aqMCN.js";import{C as I}from"./circle-check-big-Dbnaticb.js";import{D as G}from"./Drawer-Bx9DDrOI.js";import{T as L}from"./Tooltip-CP6j0BUe.js";/**
 * @license lucide-vue-next v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=z("file",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-vue-next v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=z("git-branch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]),W={components:{Handle:g,File:B,Settings:y,CirclePlus:x},props:{data:{type:Object}}},Y={class:"flex items-center space-x-1"},Z={class:"w-60 bg-white border border-gray-500 rounded-sm py-4 space-y-2 hover:shadow hover:border-blue-500 transition-all"},J={class:"flex items-center justify-between border-b border-gray-300 pb-2 mb-2 px-4"},K={class:"flex items-center space-x-2"};function Q(o,e,i,n,d,p){const c=r("File"),l=r("Settings"),h=r("CirclePlus"),a=r("Handle");return u(),m("div",Y,[t("div",Z,[t("div",J,[t("div",K,[s(c,{size:"20"}),e[0]||(e[0]=t("span",{class:"text-sm"},"Page",-1))]),s(l,{size:"20",class:"text-gray-500 cursor-pointer hover:scale-125 active:scale-100 transition-transform duration-300"})]),e[1]||(e[1]=t("div",{class:"px-4"},[t("span",{class:"text-sm truncate"},"Greeting Page"),t("p",{class:"text-sm truncate"},'Say: "Hello, welcome to Orange Botswana!"')],-1))]),s(h,{size:"20",onClick:i.data.showDrawer,class:"text-blue-500 cursor-pointer hover:scale-125 active:scale-100 transition-transform duration-300 mr-2"},null,8,["onClick"]),s(a,{type:"target",position:"left"}),s(a,{type:"source",position:"right"})])}const U=_(W,[["render",Q]]),X={components:{Handle:g,GitBranch:P,Settings:y,CirclePlus:x},props:{data:{type:Object}}},ee={class:"flex items-center space-x-1"},te={class:"w-60 bg-white border border-gray-500 rounded-sm py-4 space-y-2 hover:shadow hover:border-blue-500 transition-all"},se={class:"flex items-center justify-between border-b border-gray-300 pb-2 mb-2 px-4"},oe={class:"flex items-center space-x-2"};function ie(o,e,i,n,d,p){const c=r("GitBranch"),l=r("Settings"),h=r("CirclePlus"),a=r("Handle");return u(),m("div",ee,[t("div",te,[t("div",se,[t("div",oe,[s(c,{size:"20"}),e[0]||(e[0]=t("span",{class:"text-sm"},"Branch",-1))]),s(l,{size:"20",class:"text-gray-500 cursor-pointer hover:scale-125 active:scale-100 transition-transform duration-300"})]),e[1]||(e[1]=t("div",{class:"px-4"},[t("p",{class:"text-sm"},"If caller has billing issue → Billing Path"),t("p",{class:"text-sm"},"Else → Support Path")],-1))]),s(h,{size:"20",onClick:i.data.showDrawer,class:"text-blue-500 cursor-pointer hover:scale-125 active:scale-100 transition-transform duration-300 mr-2"},null,8,["onClick"]),s(a,{type:"target",position:"left"}),s(a,{type:"source",position:"right"})])}const re=_(X,[["render",ie]]),ne={components:{Handle:g,Mic:k,Settings:y,CirclePlus:x},props:{data:{type:Object}}},ae={class:"flex items-center space-x-1"},ce={class:"w-48 bg-white border border-gray-500 rounded-sm py-4 space-y-2 hover:shadow hover:border-blue-500 transition-all"},de={class:"flex items-center justify-between border-b border-gray-300 pb-2 mb-2 px-4"},le={class:"flex items-center space-x-2"};function pe(o,e,i,n,d,p){const c=r("Mic"),l=r("Settings"),h=r("CirclePlus"),a=r("Handle");return u(),m("div",ae,[t("div",ce,[t("div",de,[t("div",le,[s(c,{size:"20"}),e[0]||(e[0]=t("span",{class:"text-sm"},"Recording",-1))]),s(l,{size:"20",class:"text-gray-500 cursor-pointer hover:scale-125 active:scale-100 transition-transform duration-300"})]),e[1]||(e[1]=t("div",{class:"px-4"},[t("span",{class:"text-sm"},"Action: Start Recording")],-1))]),s(h,{size:"20",onClick:i.data.showDrawer,class:"text-blue-500 cursor-pointer hover:scale-125 active:scale-100 transition-transform duration-300 mr-2"},null,8,["onClick"]),s(a,{type:"target",position:"left"}),s(a,{type:"source",position:"right"})])}const he=_(ne,[["render",pe]]),ue={components:{Handle:g,Code:D,Settings:y,CirclePlus:x},props:{data:{type:Object}}},me={class:"flex items-center space-x-1"},_e={class:"w-60 bg-white border border-gray-500 rounded-sm py-4 space-y-2 hover:shadow hover:border-blue-500 transition-all"},we={class:"flex items-center justify-between border-b border-gray-300 pb-2 mb-2 px-4"},fe={class:"flex items-center space-x-2"};function ge(o,e,i,n,d,p){const c=r("Code"),l=r("Settings"),h=r("CirclePlus"),a=r("Handle");return u(),m("div",me,[t("div",_e,[t("div",we,[t("div",fe,[s(c,{size:"20"}),e[0]||(e[0]=t("span",{class:"text-sm"},"HTTP Request",-1))]),s(l,{size:"20",class:"text-gray-500 cursor-pointer hover:scale-125 active:scale-100 transition-transform duration-300"})]),e[1]||(e[1]=t("div",{class:"px-4"},[t("p",{class:"text-sm text-blue-500"},"GET"),t("p",{class:"text-sm truncate"},"/api/customer/{customer_id}"),t("p",{class:"text-sm truncate"},"Parse response: Yes")],-1))]),s(h,{size:"20",onClick:i.data.showDrawer,class:"text-blue-500 cursor-pointer hover:scale-125 active:scale-100 transition-transform duration-300 mr-2"},null,8,["onClick"]),s(a,{type:"target",position:"left"}),s(a,{type:"source",position:"right"})])}const xe=_(ue,[["render",ge]]),ye={components:{Handle:g,FileText:$,Settings:y,CirclePlus:x},props:{data:{type:Object}}},ve={class:"flex items-center space-x-1"},be={class:"w-52 bg-white border-2 border-blue-500 rounded-sm py-4 space-y-2"},$e={class:"flex items-center justify-between px-4"},Ce={class:"flex items-center space-x-2"},Se={class:"rounded-full bg-blue-500 text-white p-2"};function Ne(o,e,i,n,d,p){const c=r("FileText"),l=r("Settings"),h=r("CirclePlus"),a=r("Handle");return u(),m("div",ve,[t("div",be,[t("div",$e,[t("div",Ce,[t("div",Se,[s(c,{size:"16"})]),e[1]||(e[1]=t("span",{class:"text-sm"},"Start Script",-1))]),s(l,{size:"20",onClick:e[0]||(e[0]=()=>i.data.showDrawer(i.data)),class:"text-gray-500 cursor-pointer hover:scale-125 active:scale-100 transition-transform duration-300"})])]),s(h,{size:"20",onClick:i.data.showDrawer,class:"text-blue-500 cursor-pointer hover:scale-125 active:scale-100 transition-transform duration-300 mr-2"},null,8,["onClick"]),s(a,{type:"source",position:"right"})])}const Fe=_(ye,[["render",Ne]]),ke={components:{Handle:g,CheckCircle:I},props:{data:{type:Object}}},De={class:"flex items-center space-x-1"},ze={class:"w-32 bg-green-100 border border-green-500 rounded-4xl px-4 py-2"},Ie={class:"flex items-center space-x-2"};function Be(o,e,i,n,d,p){const c=r("CheckCircle"),l=r("Handle");return u(),m("div",De,[t("div",ze,[t("div",Ie,[s(c,{size:"16"}),e[0]||(e[0]=t("span",{class:"text-xs"},"End Script",-1))])]),s(l,{type:"target",position:"left"})])}const Pe=_(ke,[["render",Be]]),Ee={components:{Drawer:G,Tooltip:L,FileText:$},data(){return{options:[{name:"Page",icon:B,type:"page",description:"Displays a page with script prompts or instructions for the agent"},{name:"HTTP Request",icon:D,type:"http_request",description:"Makes an HTTP request to an external API (e.g., fetch customer data)"},{name:"Branch",icon:P,type:"branch",description:"Branches the script based on caller responses"},{name:"Recording",icon:k,type:"recording",description:"Records a section of the conversation for compliance or quality"},{name:"End Script",icon:I,type:"end_script",description:"Ends the script flow"}]}},methods:{showDrawer(){this.$refs.drawer.showDrawer()},hideDrawer(){this.$refs.drawer.hideDrawer()},addNode(o){this.$emit("add-node",o.type),this.hideDrawer()}}},He={class:"flex justify-between items-center space-x-2 bg-gray-100 border-b shadow-sm p-4"},Me={class:"flex items-center space-x-2"},Te={class:"flex items-center space-x-2 text-gray-700"},je={class:"grid grid-cols-3 p-2"},qe=["onClick"],Ae={class:"text-xs text-center"};function Re(o,e,i,n,d,p){const c=r("FileText"),l=r("Tooltip"),h=r("Drawer");return u(),S(h,{ref:"drawer",placement:"right",maxWidth:"max-w-md",showFooter:!1,scrollOnContent:!1},{content:b(()=>[t("div",He,[t("div",Me,[t("div",Te,[s(c,{size:"20"}),e[1]||(e[1]=t("h2",null,"Add New Action",-1))])]),(u(),m("svg",{onClick:e[0]||(e[0]=(...a)=>o.closeDrawer&&o.closeDrawer(...a)),class:"w-6 h-6 text-gray-400 cursor-pointer hover:opacity-90 active:opacity-80 active:scale-90 transition-all",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},e[2]||(e[2]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"},null,-1)])))]),e[3]||(e[3]=t("p",{class:"p-4 text-sm bg-blue-100"}," Pick an action to add to your script flow ",-1)),t("div",je,[(u(!0),m(H,null,M(d.options,(a,v)=>(u(),m("div",{key:v,onClick:C=>p.addNode(a),class:"relative space-y-2 px-2 py-4 group hover:bg-blue-50 cursor-pointer transition-all duration-500 border border-gray-300 hover:border-blue-500"},[(u(),S(T(a.icon),{size:"20",class:"mx-auto"})),t("p",Ae,F(a.name),1),s(l,{trigger:"hover",content:a.description,position:(v+1)%3===0?"left":"top",class:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-all"},null,8,["content","position"])],8,qe))),128))])]),_:1},512)}const Oe=_(Ee,[["render",Re]]),Ve={components:{Button:V,VueFlow:R,Background:A,MiniMap:q,Controls:j,NodeManagerDrawer:Oe,ScriptIcon:$},data(){return{Save:O,nodes:[],edges:[],scriptFlow:null,isSaving:!1,isEditing:!1,sourceNodeId:null,nodeTypes:{page:f(U),branch:f(re),recording:f(he),http_request:f(xe),start_script:f(Fe),end_script:f(Pe)}}},computed:{scriptFlowId(){return this.$route.params.script_flow_id}},created(){this.isEditing=!!this.scriptFlowId,this.isEditing?this.loadScriptFlow():this.initializeNewScriptFlow()},methods:{goBack(){this.$router.push({name:"show-script-flows"})},showDrawer(o){this.sourceNodeId=o,this.$refs.drawer.showDrawer()},hideDrawer(){this.$refs.drawer.hideDrawer()},initializeNewScriptFlow(){const o=N(),e={id:o,type:"start_script",position:{x:100,y:250},data:{showDrawer:()=>this.showDrawer(o)}};this.nodes=[e],this.edges=[],this.scriptFlow={name:"New Script Flow",is_active:!0}},async loadScriptFlow(){try{const o=await w.get(`/api/script-flows/${this.scriptFlowId}`,{params:{_relationships:"nodes,organization"}});this.scriptFlow=o.data.data,this.nodes=this.scriptFlow.nodes.map(e=>({id:e.id,type:e.type,position:e.position,data:{...e.metadata,showDrawer:()=>this.showDrawer(e.id)}})),this.edges=this.scriptFlow.nodes.filter(e=>e.next_step).map(e=>({id:`e${e.id}-${e.next_step}`,source:e.id,target:e.next_step}))}catch(o){console.error("Failed to load script flow:",o),this.$notificationState.showWarningNotification("Failed to load script flow."),this.$router.push({name:"show-script-flows"})}},onNodesChange(o){o.forEach(e=>{if(e.type==="position"&&e.position){const i=this.nodes.find(n=>n.id===e.id);i&&(i.position=e.position)}})},onEdgesChange(o){this.edges=o.reduce((e,i)=>{if(i.type==="add")e.push(i.item);else if(i.type==="remove")return e.filter(n=>n.id!==i.id);return e},[...this.edges])},async saveScriptFlow(){this.isSaving=!0;try{const o={name:this.scriptFlow.name,is_active:this.scriptFlow.is_active};let e;this.isEditing?e=await w.put(`/api/script-flows/${this.scriptFlowId}`,o):(e=await w.post("/api/script-flows",o),this.scriptFlowId=e.data.data.id),await this.saveNodesAndEdges(),this.$notificationState.showSuccessNotification(this.isEditing?"Script flow updated successfully!":"Script flow created successfully!"),this.$router.push({name:"show-script-flows"})}catch(o){console.error("Failed to save script flow:",o),this.$notificationState.showWarningNotification("Failed to save script flow.")}finally{this.isSaving=!1}},async saveNodesAndEdges(){const o=this.nodes.map(e=>({id:e.id,type:e.type,metadata:e.data,position:e.position,script_flow_id:this.scriptFlowId,next_step:this.getNextStep(e.id)}));for(const e of o)try{this.isEditing&&this.scriptFlow.nodes.some(i=>i.id===e.id)?await w.put(`/api/script-flow-nodes/${e.id}`,{type:e.type,next_step:e.next_step,metadata:e.metadata,position:e.position}):await w.post("/api/script-flow-nodes",{script_flow_id:this.scriptFlowId,type:e.type,next_step:e.next_step,metadata:e.metadata,position:e.position})}catch(i){throw console.error(`Failed to save node ${e.id}:`,i),i}if(this.isEditing){const e=this.nodes.map(n=>n.id),i=this.scriptFlow.nodes.filter(n=>!e.includes(n.id)).map(n=>n.id);i.length>0&&await w.delete("/api/script-flow-nodes",{params:{script_flow_node_ids:i}})}},getNextStep(o){const e=this.edges.find(i=>i.source===o);return e?e.target:null},handleAddNode(o){if(!this.sourceNodeId){console.error("No source node selected to connect the new node.");return}const e=this.nodes.find(c=>c.id===this.sourceNodeId);if(!e){console.error("Source node not found:",this.sourceNodeId);return}const i={x:e.position.x+250,y:e.position.y},n=N(),d={id:n,type:o,position:i,data:{showDrawer:()=>this.showDrawer(n)}},p={id:`e${this.sourceNodeId}-${n}`,source:this.sourceNodeId,target:n};this.nodes=[...this.nodes,d],this.edges=[...this.edges,p],this.sourceNodeId=null}}},Ge={class:"flowchart-wrapper"},Le={class:"flex justify-between items-center p-4 bg-gray-100 border-b border-gray-200"},We={class:"flex items-center space-x-2"},Ye={class:"text-lg font-semibold text-gray-900 dark:text-white"},Ze={class:"flex space-x-2"};function Je(o,e,i,n,d,p){const c=r("ScriptIcon"),l=r("Button"),h=r("MiniMap"),a=r("Controls"),v=r("Background"),C=r("VueFlow"),E=r("NodeManagerDrawer");return u(),m("div",Ge,[t("div",Le,[t("div",We,[s(c,{size:"24",class:"text-gray-600"}),t("h2",Ye,F(d.isEditing?"Edit Script Flow":"Create Script Flow"),1)]),t("div",Ze,[s(l,{type:"light",size:"md",action:p.goBack},{default:b(()=>e[0]||(e[0]=[t("span",null,"Cancel",-1)])),_:1},8,["action"]),s(l,{type:"primary",size:"md",leftIcon:d.Save,leftIconSize:"20",action:p.saveScriptFlow,loading:d.isSaving},{default:b(()=>e[1]||(e[1]=[t("span",null,"Save",-1)])),_:1},8,["leftIcon","action","loading"])])]),s(C,{nodes:d.nodes,edges:d.edges,class:"bg-gray-50","node-types":d.nodeTypes,onNodesChange:p.onNodesChange,onEdgesChange:p.onEdgesChange},{default:b(()=>[s(h),s(a,{"show-zoom":!0,"show-fit-view":!0,position:"top-right","show-interactive":!0,class:"p-2 bg-white border border-gray-200 rounded shadow-sm"}),s(v,{"pattern-color":"#aaa",gap:16})]),_:1},8,["nodes","edges","node-types","onNodesChange","onEdgesChange"]),s(E,{ref:"drawer",onAddNode:p.handleAddNode},null,8,["onAddNode"])])}const nt=_(Ve,[["render",Je]]);export{nt as default};
